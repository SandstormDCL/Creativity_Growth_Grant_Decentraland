"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.main = void 0;
const routes_1 = require("./controllers/routes");
// this function wires the business logic (adapters & controllers) with the components (ports)
async function main(program) {
    const { components, startComponents } = program;
    const globalContext = {
        components
    };
    // wire the HTTP router (make it automatic? TBD)
    const router = await (0, routes_1.setupRouter)(globalContext);
    // register routes middleware
    components.server.use(router.middleware());
    // register not implemented/method not allowed/cors responses middleware
    components.server.use(router.allowedMethods());
    // set the context to be passed to the handlers
    components.server.setContext(globalContext);
    // start ports: db, listeners, synchronizations, etc
    await startComponents();
}
exports.main = main;
//# sourceMappingURL=service.js.map