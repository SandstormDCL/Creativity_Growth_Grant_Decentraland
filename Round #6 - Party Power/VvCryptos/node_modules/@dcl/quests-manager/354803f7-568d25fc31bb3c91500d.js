"use strict";(self.webpackChunk_dcl_quests_manager=self.webpackChunk_dcl_quests_manager||[]).push([[925],{27217:function(e,t,r){r.d(t,{Mb:function(){return wt},QY:function(){return Pr},ZF:function(){return bt},i9:function(){return Nt},yh:function(){return gr}});var n=r(97326),i=r(93433),s=r(60136),a=r(82963),o=r(61120),c=r(15861),u=r(4942),p=r(35048),l=r(43144),h=(r(65743),r(17727),r(64687)),f=r.n(h),g=r(1700),d=r.n(g),v=r(86151),y=r(29858),b=r(71747),m=r(31),x=r(46421),w=r(44705),k=r(15836),E=r(56227),I=r(75225),Z=r(29062),P=r(45765),_=r(1584),S=r(4934),T=r.n(S);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,o.Z)(e);if(t){var i=(0,o.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.Z)(this,r)}}function O(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,u.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),a=s.charCodeAt(0);if(255!==r[a])throw new TypeError(s+" is ambiguous");r[a]=i}var o=e.length,c=e.charAt(0),u=Math.log(o)/Math.log(256),p=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,a=new Uint8Array(s);e[t];){var p=r[e.charCodeAt(t)];if(255===p)return;for(var l=0,h=s-1;(0!==p||l<i)&&-1!==h;h--,l++)p+=o*a[h]>>>0,a[h]=p%256>>>0,p=p/256>>>0;if(0!==p)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===a[f];)f++;for(var g=new Uint8Array(n+(s-f)),d=n;f!==s;)g[d++]=a[f++];return g}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var a=(s-i)*p+1>>>0,u=new Uint8Array(a);i!==s;){for(var l=t[i],h=0,f=a-1;(0!==l||h<n)&&-1!==f;f--,h++)l+=256*u[f]>>>0,u[f]=l%o>>>0,l=l/o>>>0;if(0!==l)throw new Error("Non-zero carry");n=h,i++}for(var g=a-n;g!==a&&0===u[g];)g++;for(var d=c.repeat(r);g<a;++g)d+=e.charAt(u[g]);return d},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error("Non-".concat(t," character"))}}},L=function(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},N=function(){function e(t,r,n){(0,p.Z)(this,e),this.name=t,this.prefix=r,this.baseEncode=n}return(0,l.Z)(e,[{key:"encode",value:function(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}]),e}(),U=function(){function e(t,r,n){if((0,p.Z)(this,e),this.name=t,this.prefix=r,void 0===r.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}return(0,l.Z)(e,[{key:"decode",value:function(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}},{key:"or",value:function(e){return j(this,e)}}]),e}(),M=function(){function e(t){(0,p.Z)(this,e),this.decoders=t}return(0,l.Z)(e,[{key:"or",value:function(e){return j(this,e)}},{key:"decode",value:function(e){var t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}]),e}(),j=function(e,t){return new M(A(A({},e.decoders||(0,u.Z)({},e.prefix,e)),t.decoders||(0,u.Z)({},t.prefix,t)))},K=function(){function e(t,r,n,i){(0,p.Z)(this,e),this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new N(t,r,n),this.decoder=new U(t,r,i)}return(0,l.Z)(e,[{key:"encode",value:function(e){return this.encoder.encode(e)}},{key:"decode",value:function(e){return this.decoder.decode(e)}}]),e}(),q=function(e){var t=e.name,r=e.prefix,n=e.encode,i=e.decode;return new K(t,r,n,i)},B=function(e){var t=e.prefix,r=e.name,n=e.alphabet,i=D(n,r),s=i.encode,a=i.decode;return q({prefix:t,name:r,encode:s,decode:function(e){return L(a(e))}})},V=function(e){var t=e.name,r=e.prefix,n=e.bitsPerChar,i=e.alphabet;return q({prefix:r,name:t,encode:function(e){return function(e,t,r){for(var n="="===t[t.length-1],i=(1<<r)-1,s="",a=0,o=0,c=0;c<e.length;++c)for(o=o<<8|e[c],a+=8;a>r;)s+=t[i&o>>(a-=r)];if(a&&(s+=t[i&o<<r-a]),n)for(;s.length*r&7;)s+="=";return s}(e,i,n)},decode:function(e){return function(e,t,r,n){for(var i={},s=0;s<t.length;++s)i[t[s]]=s;for(var a=e.length;"="===e[a-1];)--a;for(var o=new Uint8Array(a*r/8|0),c=0,u=0,p=0,l=0;l<a;++l){var h=i[e[l]];if(void 0===h)throw new SyntaxError("Non-".concat(n," character"));u=u<<r|h,(c+=r)>=8&&(c-=8,o[p++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o}(e,i,n,t)}})},J=q({prefix:"\0",name:"identity",encode:function(e){return function(e){return(new TextDecoder).decode(e)}(e)},decode:function(e){return function(e){return(new TextEncoder).encode(e)}(e)}}),H=Object.freeze({__proto__:null,identity:J}),F=V({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),W=Object.freeze({__proto__:null,base2:F}),Y=V({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),G=Object.freeze({__proto__:null,base8:Y}),Q=B({prefix:"9",name:"base10",alphabet:"0123456789"}),X=Object.freeze({__proto__:null,base10:Q}),$=V({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ee=V({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),te=Object.freeze({__proto__:null,base16:$,base16upper:ee}),re=V({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ne=V({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ie=V({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),se=V({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ae=V({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oe=V({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ce=V({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ue=V({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),pe=V({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),le=Object.freeze({__proto__:null,base32:re,base32upper:ne,base32pad:ie,base32padupper:se,base32hex:ae,base32hexupper:oe,base32hexpad:ce,base32hexpadupper:ue,base32z:pe}),he=B({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fe=B({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ge=Object.freeze({__proto__:null,base36:he,base36upper:fe}),de=B({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ve=B({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ye=Object.freeze({__proto__:null,base58btc:de,base58flickr:ve}),be=V({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),me=V({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xe=V({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),we=V({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ke=Object.freeze({__proto__:null,base64:be,base64pad:me,base64url:xe,base64urlpad:we}),Ee=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Ie=Ee.reduce((function(e,t,r){return e[r]=t,e}),[]),Ze=Ee.reduce((function(e,t,r){return e[t.codePointAt(0)]=r,e}),[]);var Pe=q({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((function(e,t){return e+=Ie[t]}),"")},decode:function(e){var t,r=[],n=O(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=Ze[i.codePointAt(0)];if(void 0===s)throw new Error("Non-base256emoji character: ".concat(i));r.push(s)}}catch(a){n.e(a)}finally{n.f()}return new Uint8Array(r)}}),_e=Object.freeze({__proto__:null,base256emoji:Pe}),Se=function e(t,r,n){r=r||[];for(var i=n=n||0;t>=Oe;)r[n++]=255&t|Te,t/=128;for(;t&Re;)r[n++]=255&t|Te,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Te=128,Re=-128,Oe=Math.pow(2,31);var ze=function e(t,r){var n,i=0,s=0,a=r=r||0,o=t.length;do{if(a>=o)throw e.bytes=0,new RangeError("Could not decode varint");n=t[a++],i+=s<28?(n&Ae)<<s:(n&Ae)*Math.pow(2,s),s+=7}while(n>=Ce);return e.bytes=a-r,i},Ce=128,Ae=127;var De=Math.pow(2,7),Le=Math.pow(2,14),Ne=Math.pow(2,21),Ue=Math.pow(2,28),Me=Math.pow(2,35),je=Math.pow(2,42),Ke=Math.pow(2,49),qe=Math.pow(2,56),Be=Math.pow(2,63),Ve={encode:Se,decode:ze,encodingLength:function(e){return e<De?1:e<Le?2:e<Ne?3:e<Ue?4:e<Me?5:e<je?6:e<Ke?7:e<qe?8:e<Be?9:10}},Je=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ve.encode(e,t,r),t},He=function(e){return Ve.encodingLength(e)},Fe=function(e,t){var r=t.byteLength,n=He(e),i=n+He(r),s=new Uint8Array(i+r);return Je(e,s,0),Je(r,s,n),s.set(t,i),new We(e,r,t,s)},We=(0,l.Z)((function e(t,r,n,i){(0,p.Z)(this,e),this.code=t,this.size=r,this.digest=n,this.bytes=i})),Ye=function(e){var t=e.name,r=e.code,n=e.encode;return new Ge(t,r,n)},Ge=function(){function e(t,r,n){(0,p.Z)(this,e),this.name=t,this.code=r,this.encode=n}return(0,l.Z)(e,[{key:"digest",value:function(e){var t=this;if(e instanceof Uint8Array){var r=this.encode(e);return r instanceof Uint8Array?Fe(this.code,r):r.then((function(e){return Fe(t.code,e)}))}throw Error("Unknown type, must be binary type")}}]),e}(),Qe=function(e){return function(){var t=(0,c.Z)(f().mark((function t(r){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,crypto.subtle.digest(e,r);case 3:return t.t1=t.sent,t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Xe=Ye({name:"sha2-256",code:18,encode:Qe("SHA-256")}),$e=Ye({name:"sha2-512",code:19,encode:Qe("SHA-512")}),et=Object.freeze({__proto__:null,sha256:Xe,sha512:$e}),tt=L,rt={code:0,name:"identity",encode:tt,digest:function(e){return Fe(0,tt(e))}},nt=Object.freeze({__proto__:null,identity:rt});new TextEncoder,new TextDecoder;var it=A(A(A(A(A(A(A(A(A(A({},H),W),G),X),te),le),ge),ye),ke),_e);function st(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function at(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}A(A({},et),nt);var ot=at("utf8","u",(function(e){return"u"+new TextDecoder("utf8").decode(e)}),(function(e){return(new TextEncoder).encode(e.substring(1))})),ct=at("ascii","a",(function(e){for(var t="a",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(function(e){for(var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?st(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),ut=A({utf8:ot,"utf-8":ot,hex:it.base16,latin1:ct,ascii:ct,binary:ct},it);function pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=ut[t];if(!r)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode("".concat(r.prefix).concat(e)):st(globalThis.Buffer.from(e,"utf-8"))}var lt="core",ht="".concat("wc","@2:").concat(lt,":"),ft="error",gt={database:":memory:"},dt="client_ed25519_seed",vt=I.ONE_DAY,yt=I.SIX_HOURS,bt="irn",mt="wss://relay.walletconnect.com",xt="wss://relay.walletconnect.org",wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},kt="payload",Et="connect",It="disconnect",Zt="error",Pt=I.ONE_SECOND/2,_t="subscription_created",St="subscription_deleted",Tt="subscription_sync",Rt="subscription_resubscribed",Ot=1e3*I.FIVE_SECONDS,zt={wc_pairingDelete:{req:{ttl:I.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:I.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:I.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:I.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:I.ONE_DAY,prompt:!1,tag:0},res:{ttl:I.ONE_DAY,prompt:!1,tag:0}}},Ct="history_created",At="history_updated",Dt="history_deleted",Lt="history_sync",Nt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ut="verify-api",Mt="https://verify.walletconnect.com",jt=function(){function e(t,r){var n=this;(0,p.Z)(this,e),this.core=t,this.logger=r,this.keychain=new Map,this.name="keychain",this.version="0.3",this.initialized=!1,this.storagePrefix=ht,this.init=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.initialized){e.next=5;break}return e.next=3,n.getKeyChain();case 3:typeof(t=e.sent)<"u"&&(n.keychain=t),n.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.has=function(e){return n.isInitialized(),n.keychain.has(e)},this.set=function(){var e=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.keychain.set(t,r),e.next=4,n.persist();case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.get=function(e){n.isInitialized();var t=n.keychain.get(e);if(typeof t>"u"){var r=(0,k.Z7)("NO_MATCHING_KEY","".concat(n.name,": ").concat(e)).message;throw new Error(r)}return t},this.del=function(){var e=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.keychain.delete(t),e.next=4,n.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,b.generateChildLogger)(r,this.name)}var t,r,n;return(0,l.Z)(e,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setKeyChain",value:(n=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,(0,k.KC)(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getKeyChain",value:(r=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",typeof t<"u"?(0,k.IP)(t):void 0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"persist",value:(t=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setKeyChain(this.keychain);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}(),Kt=function(){function e(t,r,n){var i=this;(0,p.Z)(this,e),this.core=t,this.logger=r,this.name="crypto",this.initialized=!1,this.init=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.initialized,e.t0){e.next=5;break}return e.next=4,i.keychain.init();case 4:i.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.hasKeys=function(e){return i.isInitialized(),i.keychain.has(e)},this.getClientId=(0,c.Z)(f().mark((function e(){var t,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.getClientSeed();case 3:return t=e.sent,r=w.generateKeyPair(t),e.abrupt("return",w.encodeIss(r.publicKey));case 6:case"end":return e.stop()}}),e)}))),this.generateKeyPair=function(){i.isInitialized();var e=(0,k.Au)();return i.setPrivateKey(e.publicKey,e.privateKey)},this.signJWT=function(){var e=(0,c.Z)(f().mark((function e(t){var r,n,s,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.getClientSeed();case 3:return r=e.sent,n=w.generateKeyPair(r),s=(0,k.jd)(),a=vt,e.next=9,w.signJWT(s,t,a,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.generateSharedKey=function(e,t,r){i.isInitialized();var n=i.getPrivateKey(e),s=(0,k.m$)(n,t);return i.setSymKey(s,r)},this.setSymKey=function(){var e=(0,c.Z)(f().mark((function e(t,r){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),n=r||(0,k.Ym)(t),e.next=4,i.keychain.set(n,t);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.deleteKeyPair=function(){var e=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.keychain.del(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteSymKey=function(){var e=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.isInitialized(),e.next=3,i.keychain.del(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.encode=function(){var e=(0,c.Z)(f().mark((function e(t,r,n){var s,a,o,c,u,p,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),s=(0,k.EN)(n),a=(0,x.u)(r),!(0,k.Q8)(s)){e.next=7;break}return o=s.senderPublicKey,c=s.receiverPublicKey,e.next=6,i.generateSharedKey(o,c);case 6:t=e.sent;case 7:return u=i.getSymKey(t),p=s.type,l=s.senderPublicKey,e.abrupt("return",(0,k.HI)({type:p,symKey:u,message:a,senderPublicKey:l}));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.decode=function(){var e=(0,c.Z)(f().mark((function e(t,r,n){var s,a,o,c,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isInitialized(),s=(0,k.Ll)(r,n),!(0,k.Q8)(s)){e.next=7;break}return a=s.receiverPublicKey,o=s.senderPublicKey,e.next=6,i.generateSharedKey(a,o);case 6:t=e.sent;case 7:return e.prev=7,c=i.getSymKey(t),u=(0,k.pe)({symKey:c,encoded:r}),e.abrupt("return",(0,x.D)(u));case 12:return e.prev=12,e.t0=e.catch(7),e.t1=i.logger,e.t2="Failed to decode message from topic: '".concat(t,"', clientId: '"),e.next=18,i.getClientId();case 18:e.t3=e.sent,e.t4=e.t2.concat.call(e.t2,e.t3,"'"),e.t1.error.call(e.t1,e.t4),i.logger.error(e.t0);case 22:case"end":return e.stop()}}),e,null,[[7,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),this.getPayloadType=function(e){var t=(0,k.vB)(e);return(0,k.WG)(t.type)},this.getPayloadSenderPublicKey=function(e){var t=(0,k.vB)(e);return t.senderPublicKey?(0,E.BB)(t.senderPublicKey,k.AW):void 0},this.core=t,this.logger=(0,b.generateChildLogger)(r,this.name),this.keychain=n||new jt(this.core,this.logger)}var t,r;return(0,l.Z)(e,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"setPrivateKey",value:(r=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keychain.set(t,r);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"getPrivateKey",value:function(e){return this.keychain.get(e)}},{key:"getClientSeed",value:(t=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="",e.prev=1,t=this.keychain.get(dt),e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(1),t=(0,k.jd)(),e.next=10,this.keychain.set(dt,t);case 10:return e.abrupt("return",pt(t,"base16"));case 11:case"end":return e.stop()}}),e,this,[[1,5]])}))),function(){return t.apply(this,arguments)})},{key:"getSymKey",value:function(e){return this.keychain.get(e)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}(),qt=function(e){(0,s.Z)(a,e);var t,r,n,i=R(a);function a(e,t){var r;return(0,p.Z)(this,a),(r=i.call(this,e,t)).logger=e,r.core=t,r.messages=new Map,r.name="messages",r.version="0.3",r.initialized=!1,r.storagePrefix=ht,r.init=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.initialized){e.next=15;break}return r.logger.trace("Initialized"),e.prev=2,e.next=5,r.getRelayerMessages();case 5:typeof(t=e.sent)<"u"&&(r.messages=t),r.logger.debug("Successfully Restored records for ".concat(r.name)),r.logger.trace({type:"method",method:"restore",size:r.messages.size}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),r.logger.debug("Failed to Restore records for ".concat(r.name)),r.logger.error(e.t0);case 12:return e.prev=12,r.initialized=!0,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,9,12,15]])}))),r.set=function(){var e=(0,c.Z)(f().mark((function e(t,n){var i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),i=(0,k.rj)(n),typeof(s=r.messages.get(t))>"u"&&(s={}),e.t0=typeof s[i]<"u",e.t0){e.next=10;break}return s[i]=n,r.messages.set(t,s),e.next=10,r.persist();case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.get=function(e){r.isInitialized();var t=r.messages.get(e);return typeof t>"u"&&(t={}),t},r.has=function(e,t){return r.isInitialized(),typeof r.get(e)[(0,k.rj)(t)]<"u"},r.del=function(){var e=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.messages.delete(t),e.next=4,r.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.logger=(0,b.generateChildLogger)(e,r.name),r.core=t,r}return(0,l.Z)(a,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setRelayerMessages",value:(n=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,(0,k.KC)(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getRelayerMessages",value:(r=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",typeof t<"u"?(0,k.IP)(t):void 0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"persist",value:(t=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerMessages(this.messages);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),a}(m.kZ),Bt=function(e){(0,s.Z)(r,e);var t=R(r);function r(e,n){var i;return(0,p.Z)(this,r),(i=t.call(this,e,n)).relayer=e,i.logger=n,i.events=new g.EventEmitter,i.name="publisher",i.queue=new Map,i.publishTimeout=(0,I.toMiliseconds)(I.TEN_SECONDS),i.queueTimeout=(0,I.toMiliseconds)(I.FIVE_SECONDS),i.needsTransportRestart=!1,i.publish=function(){var e=(0,c.Z)(f().mark((function e(t,r,n){var s,a,o,c,u,p,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.logger.debug("Publishing Payload"),i.logger.trace({type:"method",method:"publish",params:{topic:t,message:r,opts:n}}),e.prev=1,s=(null==n?void 0:n.ttl)||yt,a=(0,k._H)(n),o=(null==n?void 0:n.prompt)||!1,c=(null==n?void 0:n.tag)||0,u=(null==n?void 0:n.id)||(0,P.getBigIntRpcId)().toString(),p={topic:t,message:r,opts:{ttl:s,relay:a,prompt:o,tag:c,id:u}},l=setTimeout((function(){return i.queue.set(u,p)}),i.queueTimeout),e.prev=3,e.next=6,(0,k.hF)(i.rpcPublish(t,r,s,a,o,c,u),i.publishTimeout);case 6:return e.next=8,e.sent;case 8:clearTimeout(l),i.relayer.events.emit(wt.publish,p),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(3),i.logger.debug("Publishing Payload stalled"),i.needsTransportRestart=!0,e.abrupt("return");case 16:i.logger.debug("Successfully Published Payload"),i.logger.trace({type:"method",method:"publish",params:{topic:t,message:r,opts:n}}),e.next=22;break;case 19:throw e.prev=19,e.t1=e.catch(1),i.logger.debug("Failed to Publish Payload"),i.logger.error(e.t1),e.t1;case 22:case"end":return e.stop()}}),e,null,[[1,19],[3,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),i.on=function(e,t){i.events.on(e,t)},i.once=function(e,t){i.events.once(e,t)},i.off=function(e,t){i.events.off(e,t)},i.removeListener=function(e,t){i.events.removeListener(e,t)},i.relayer=e,i.logger=(0,b.generateChildLogger)(n,i.name),i.registerEventListeners(),i}return(0,l.Z)(r,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"rpcPublish",value:function(e,t,r,n,i,s,a){var o,c,u,p,l={method:(0,k.cO)(n.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:i,tag:s},id:a};return(0,k.o8)(null==(o=l.params)?void 0:o.prompt)&&(null==(c=l.params)||delete c.prompt),(0,k.o8)(null==(u=l.params)?void 0:u.tag)&&(null==(p=l.params)||delete p.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:l}),this.relayer.request(l)}},{key:"onPublish",value:function(e){this.queue.delete(e)}},{key:"checkQueue",value:function(){var e=this;this.queue.forEach(function(){var t=(0,c.Z)(f().mark((function t(r){var n,i,s;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.topic,i=r.message,s=r.opts,t.next=3,e.publish(n,i,s);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(y.HEARTBEAT_EVENTS.pulse,(function(){if(e.needsTransportRestart)return e.needsTransportRestart=!1,void e.relayer.events.emit(wt.connection_stalled);e.checkQueue()})),this.relayer.on(wt.message_ack,(function(t){e.onPublish(t.id.toString())}))}}]),r}(m.z9),Vt=function(){function e(){var t=this;(0,p.Z)(this,e),this.map=new Map,this.set=function(e,r){var n=t.get(e);t.exists(e,r)||t.map.set(e,[].concat((0,i.Z)(n),[r]))},this.get=function(e){return t.map.get(e)||[]},this.exists=function(e,r){return t.get(e).includes(r)},this.delete=function(e,r){if(typeof r>"u")t.map.delete(e);else if(t.map.has(e)){var n=t.get(e);if(t.exists(e,r)){var i=n.filter((function(e){return e!==r}));i.length?t.map.set(e,i):t.map.delete(e)}}},this.clear=function(){t.map.clear()}}return(0,l.Z)(e,[{key:"topics",get:function(){return Array.from(this.map.keys())}}]),e}(),Jt=Object.defineProperty,Ht=Object.defineProperties,Ft=Object.getOwnPropertyDescriptors,Wt=Object.getOwnPropertySymbols,Yt=Object.prototype.hasOwnProperty,Gt=Object.prototype.propertyIsEnumerable,Qt=function(e,t,r){return t in e?Jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Xt=function(e,t){for(var r in t||(t={}))Yt.call(t,r)&&Qt(e,r,t[r]);if(Wt){var n,i=O(Wt(t));try{for(i.s();!(n=i.n()).done;){r=n.value;Gt.call(t,r)&&Qt(e,r,t[r])}}catch(s){i.e(s)}finally{i.f()}}return e},$t=function(e,t){return Ht(e,Ft(t))},er=function(e){(0,s.Z)(P,e);var t,r,n,i,a,o,u,h,d,v,m,x,w,E,Z=R(P);function P(e,t){var r;return(0,p.Z)(this,P),(r=Z.call(this,e,t)).relayer=e,r.logger=t,r.subscriptions=new Map,r.topicMap=new Vt,r.events=new g.EventEmitter,r.name="subscription",r.version="0.3",r.pending=new Map,r.cached=[],r.initialized=!1,r.pendingSubscriptionWatchLabel="pending_sub_watch_label",r.pollingInterval=20,r.storagePrefix=ht,r.subscribeTimeout=1e4,r.restartInProgress=!1,r.batchSubscribeTopicsLimit=500,r.init=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=10;break}return r.logger.trace("Initialized"),e.next=5,r.restart();case 5:return r.registerEventListeners(),r.onEnable(),e.next=9,r.relayer.core.crypto.getClientId();case 9:r.clientId=e.sent;case 10:case"end":return e.stop()}}),e)}))),r.subscribe=function(){var e=(0,c.Z)(f().mark((function e(t,n){var i,s,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.restartToComplete();case 2:return r.isInitialized(),r.logger.debug("Subscribing Topic"),r.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:n}}),e.prev=5,i=(0,k._H)(n),s={topic:t,relay:i},r.pending.set(t,s),e.next=10,r.rpcSubscribe(t,i);case 10:return a=e.sent,e.abrupt("return",(r.onSubscribe(a,s),r.logger.debug("Successfully Subscribed Topic"),r.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:n}}),a));case 14:throw e.prev=14,e.t0=e.catch(5),r.logger.debug("Failed to Subscribe Topic"),r.logger.error(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,r){return e.apply(this,arguments)}}(),r.unsubscribe=function(){var e=(0,c.Z)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.restartToComplete();case 2:if(r.isInitialized(),!(typeof(null==n?void 0:n.id)<"u")){e.next=8;break}return e.next=6,r.unsubscribeById(t,n.id,n);case 6:e.next=10;break;case 8:return e.next=10,r.unsubscribeByTopic(t,n);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.isSubscribed=function(){var e=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.topics.includes(t)){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,new Promise((function(e,n){var i=new I.Watch;i.start(r.pendingSubscriptionWatchLabel);var s=setInterval((function(){!r.pending.has(t)&&r.topics.includes(t)&&(clearInterval(s),i.stop(r.pendingSubscriptionWatchLabel),e(!0)),i.elapsed(r.pendingSubscriptionWatchLabel)>=Ot&&(clearInterval(s),i.stop(r.pendingSubscriptionWatchLabel),n(new Error("Subscription resolution timeout")))}),r.pollingInterval)})).catch((function(){return!1}));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.on=function(e,t){r.events.on(e,t)},r.once=function(e,t){r.events.once(e,t)},r.off=function(e,t){r.events.off(e,t)},r.removeListener=function(e,t){r.events.removeListener(e,t)},r.restart=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.restartInProgress=!0,e.next=3,r.restore();case 3:return e.next=5,r.reset();case 5:r.restartInProgress=!1;case 6:case"end":return e.stop()}}),e)}))),r.relayer=e,r.logger=(0,b.generateChildLogger)(t,r.name),r.clientId="",r}return(0,l.Z)(P,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.subscriptions.size}},{key:"ids",get:function(){return Array.from(this.subscriptions.keys())}},{key:"values",get:function(){return Array.from(this.subscriptions.values())}},{key:"topics",get:function(){return this.topicMap.topics}},{key:"hasSubscription",value:function(e,t){var r=!1;try{r=this.getSubscription(e).topic===t}catch(n){}return r}},{key:"onEnable",value:function(){this.cached=[],this.initialized=!0}},{key:"onDisable",value:function(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}},{key:"unsubscribeByTopic",value:(E=(0,c.Z)(f().mark((function e(t,r){var n,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.topicMap.get(t),e.next=3,Promise.all(n.map(function(){var e=(0,c.Z)(f().mark((function e(n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.unsubscribeById(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"unsubscribeById",value:(w=(0,c.Z)(f().mark((function e(t,r,n){var i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}}),e.prev=1,i=(0,k._H)(n),e.next=5,this.rpcUnsubscribe(t,r,i);case 5:return s=(0,k.D6)("USER_DISCONNECTED","".concat(this.name,", ").concat(t)),e.next=8,this.onUnsubscribe(t,r,s);case 8:this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}}),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t,r){return w.apply(this,arguments)})},{key:"rpcSubscribe",value:(x=(0,c.Z)(f().mark((function e(t,r){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:(0,k.cO)(r.protocol).subscribe,params:{topic:t}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),e.prev=2,e.next=5,(0,k.hF)(this.relayer.request(n),this.subscribeTimeout);case 5:return e.next=7,e.sent;case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(wt.connection_stalled);case 12:return e.abrupt("return",(0,k.rj)(t+this.clientId));case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e,t){return x.apply(this,arguments)})},{key:"rpcBatchSubscribe",value:(m=(0,c.Z)(f().mark((function e(t){var r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return r=t[0].relay,n={method:(0,k.cO)(r.protocol).batchSubscribe,params:{topics:t.map((function(e){return e.topic}))}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),e.prev=4,e.next=7,(0,k.hF)(this.relayer.request(n),this.subscribeTimeout);case 7:return e.next=9,e.sent;case 9:return e.abrupt("return",e.sent);case 12:e.prev=12,e.t0=e.catch(4),this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(wt.connection_stalled);case 15:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return m.apply(this,arguments)})},{key:"rpcUnsubscribe",value:function(e,t,r){var n={method:(0,k.cO)(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}},{key:"onSubscribe",value:function(e,t){this.setSubscription(e,$t(Xt({},t),{id:e})),this.pending.delete(t.topic)}},{key:"onBatchSubscribe",value:function(e){var t=this;e.length&&e.forEach((function(e){t.setSubscription(e.id,Xt({},e)),t.pending.delete(e.topic)}))}},{key:"onUnsubscribe",value:(v=(0,c.Z)(f().mark((function e(t,r,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),e.next=4,this.relayer.messages.del(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return v.apply(this,arguments)})},{key:"setRelayerSubscriptions",value:(d=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getRelayerSubscriptions",value:(h=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"setSubscription",value:function(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}},{key:"addSubscription",value:function(e,t){this.subscriptions.set(e,Xt({},t)),this.topicMap.set(t.topic,e),this.events.emit(_t,t)}},{key:"getSubscription",value:function(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});var t=this.subscriptions.get(e);if(!t){var r=(0,k.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(r)}return t}},{key:"deleteSubscription",value:function(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});var r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(St,$t(Xt({},r),{reason:t}))}},{key:"persist",value:(u=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerSubscriptions(this.values);case 2:this.events.emit(Tt);case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"reset",value:(o=(0,c.Z)(f().mark((function e(){var t,r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cached.length){e.next=10;break}t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit),r=0;case 3:if(!(r<t)){e.next=10;break}return n=this.cached.splice(0,this.batchSubscribeTopicsLimit),e.next=7,this.batchSubscribe(n);case 7:r++,e.next=3;break;case 10:this.events.emit(Rt);case 11:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"restore",value:(a=(0,c.Z)(f().mark((function e(){var t,r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getRelayerSubscriptions();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.subscriptions.size){e.next=9;break}throw r=(0,k.Z7)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),this.logger.error("".concat(this.name,": ").concat(JSON.stringify(this.values))),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored subscriptions for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore subscriptions for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return a.apply(this,arguments)})},{key:"batchSubscribe",value:(i=(0,c.Z)(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.rpcBatchSubscribe(t);case 4:r=e.sent,(0,k.qt)(r)&&this.onBatchSubscribe(r.map((function(e,r){return $t(Xt({},t[r]),{id:e})})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onConnect",value:(n=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.restartInProgress,e.t0){e.next=5;break}return e.next=4,this.restart();case 4:this.onEnable();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onDisconnect",value:function(){this.onDisable()}},{key:"checkPending",value:(r=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.relayer.transportExplicitlyClosed){e.next=2;break}return e.abrupt("return");case 2:return t=[],this.pending.forEach((function(e){t.push(e)})),e.next=6,this.batchSubscribe(t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(y.HEARTBEAT_EVENTS.pulse,(0,c.Z)(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkPending();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(wt.connect,(0,c.Z)(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onConnect();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(wt.disconnect,(function(){e.onDisconnect()})),this.events.on(_t,function(){var t=(0,c.Z)(f().mark((function t(r){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_t,e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:r}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.events.on(St,function(){var t=(0,c.Z)(f().mark((function t(r){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=St,e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:r}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"restartToComplete",value:(t=(0,c.Z)(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.restartInProgress,!e.t0){e.next=4;break}return e.next=4,new Promise((function(e){var r=setInterval((function(){t.restartInProgress||(clearInterval(r),e())}),t.pollingInterval)}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),P}(m.sY),tr=Object.defineProperty,rr=Object.getOwnPropertySymbols,nr=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable,sr=function(e,t,r){return t in e?tr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},ar=function(e,t){for(var r in t||(t={}))nr.call(t,r)&&sr(e,r,t[r]);if(rr){var n,i=O(rr(t));try{for(i.s();!(n=i.n()).done;){r=n.value;ir.call(t,r)&&sr(e,r,t[r])}}catch(s){i.e(s)}finally{i.f()}}return e},or=function(e){(0,s.Z)(T,e);var t,r,i,a,o,u,h,d,v,y,m,x,w,E,S=R(T);function T(e){var t;return(0,p.Z)(this,T),(t=S.call(this,e)).protocol="wc",t.version=2,t.events=new g.EventEmitter,t.name="relayer",t.transportExplicitlyClosed=!1,t.initialized=!1,t.reconnecting=!1,t.connectionStatusPollingInterval=20,t.staleConnectionErrors=["socket hang up","socket stalled"],t.request=function(){var e=(0,c.Z)(f().mark((function e(r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.logger.debug("Publishing Request Payload"),e.prev=1,e.next=4,t.toEstablishConnection();case 4:return e.next=6,t.provider.request(r);case 6:return e.abrupt("return",e.sent);case 9:throw e.prev=9,e.t0=e.catch(1),t.logger.debug("Failed to Publish Request"),t.logger.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),t.core=e.core,t.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,b.generateChildLogger)(e.logger,t.name):(0,b.pino)((0,b.getDefaultLoggerOptions)({level:e.logger||"error"})),t.messages=new qt(t.logger,e.core),t.subscriber=new er((0,n.Z)(t),t.logger),t.publisher=new Bt((0,n.Z)(t),t.logger),t.relayUrl=(null==e?void 0:e.relayUrl)||mt,t.projectId=e.projectId,t.provider={},t}return(0,l.Z)(T,[{key:"init",value:(E=(0,c.Z)(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.next=3,this.createProvider();case 3:return e.next=5,Promise.all([this.messages.init(),this.subscriber.init()]);case 5:return e.prev=5,e.next=8,this.transportOpen();case 8:e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(5),this.logger.warn("Connection via ".concat(this.relayUrl," failed, attempting to connect via failover domain ").concat(xt,"...")),e.next=15,this.restartTransport(xt);case 15:this.registerEventListeners(),this.initialized=!0,setTimeout((0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=0===t.subscriber.topics.length,!e.t0){e.next=6;break}return t.logger.info("No topics subscribed to after init, closing transport"),e.next=5,t.transportClose();case 5:t.transportExplicitlyClosed=!1;case 6:case"end":return e.stop()}}),e)}))),1e4);case 16:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(){return E.apply(this,arguments)})},{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"connected",get:function(){return this.provider.connection.connected}},{key:"connecting",get:function(){return this.provider.connection.connecting}},{key:"publish",value:(w=(0,c.Z)(f().mark((function e(t,r,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.publisher.publish(t,r,n);case 3:return e.next=5,this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()});case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return w.apply(this,arguments)})},{key:"subscribe",value:(x=(0,c.Z)(f().mark((function e(t,r){var n,i,s=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized(),i=(null==(n=this.subscriber.topicMap.get(t))?void 0:n[0])||"",e.t0=i,e.t0){e.next=7;break}return e.next=6,Promise.all([new Promise((function(e){s.subscriber.once(_t,(function(r){r.topic===t&&e()}))})),new Promise(function(){var e=(0,c.Z)(f().mark((function e(n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.subscriber.subscribe(t,r);case 2:i=e.sent,n();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())]);case 6:e.t0=i;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"unsubscribe",value:(m=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.subscriber.unsubscribe(t,r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"transportClose",value:(y=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transportExplicitlyClosed=!0,e.t0=this.connected,!e.t0){e.next=6;break}return e.next=5,this.provider.disconnect();case 5:this.events.emit(wt.transport_closed);case 6:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"transportOpen",value:(v=(0,c.Z)(f().mark((function e(t){var r,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transportExplicitlyClosed=!1,this.reconnecting){e.next=23;break}return this.relayUrl=t||this.relayUrl,this.reconnecting=!0,e.prev=2,e.t0=Promise,e.t1=new Promise((function(e){n.initialized||e(),n.subscriber.once(Rt,(function(){e()}))})),e.next=7,Promise.race([new Promise(function(){var e=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.hF)(n.provider.connect(),1e4,"Socket stalled when trying to connect to ".concat(n.relayUrl)).catch((function(e){return r(e)})).then((function(){return t()})).finally((function(){return n.removeListener(wt.transport_closed,n.rejectTransportOpen)}));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),new Promise((function(e){return n.once(wt.transport_closed,n.rejectTransportOpen)}))]);case 7:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=11,e.t0.all.call(e.t0,e.t3);case 11:e.next=20;break;case 13:if(e.prev=13,e.t4=e.catch(2),this.logger.error(e.t4),r=e.t4,this.isConnectionStalled(r.message)){e.next=19;break}throw e.t4;case 19:this.events.emit(wt.transport_closed);case 20:return e.prev=20,this.reconnecting=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[2,13,20,23]])}))),function(e){return v.apply(this,arguments)})},{key:"restartTransport",value:(d=(0,c.Z)(f().mark((function e(t){var r=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.transportExplicitlyClosed||this.reconnecting,e.t0){e.next=11;break}if(this.relayUrl=t||this.relayUrl,e.t1=this.connected,!e.t1){e.next=7;break}return e.next=7,Promise.all([new Promise((function(e){r.provider.once(It,(function(){e()}))})),this.transportClose()]);case 7:return e.next=9,this.createProvider();case 9:return e.next=11,this.transportOpen();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"isConnectionStalled",value:function(e){return this.staleConnectionErrors.some((function(t){return e.includes(t)}))}},{key:"rejectTransportOpen",value:function(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}},{key:"createProvider",value:(h=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.crypto.signJWT(this.relayUrl);case 2:t=e.sent,this.provider=new Z.r(new _.Z((0,k.$0)({sdkVersion:"2.9.2",protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners();case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"recordMessageEvent",value:(u=(0,c.Z)(f().mark((function e(t){var r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,n=t.message,e.next=3,this.messages.set(r,n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"shouldIgnoreMessageEvent",value:(o=(0,c.Z)(f().mark((function e(t){var r,n,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.topic,(n=t.message)&&0!==n.length){e.next=3;break}return e.abrupt("return",(this.logger.debug("Ignoring invalid/empty message: ".concat(n)),!0));case 3:return e.next=5,this.subscriber.isSubscribed(r);case 5:if(e.sent){e.next=7;break}return e.abrupt("return",(this.logger.debug("Ignoring message for non-subscribed topic ".concat(r)),!0));case 7:return i=this.messages.has(r,n),e.abrupt("return",(i&&this.logger.debug("Ignoring duplicate message: ".concat(n)),i));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"onProviderPayload",value:(a=(0,c.Z)(f().mark((function e(t){var r,n,i,s,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),!(0,P.isJsonRpcRequest)(t)){e.next=13;break}if(t.method.endsWith("_subscription")){e.next=3;break}return e.abrupt("return");case 3:return r=t.params,n=r.data,i=n.topic,s=n.message,a=n.publishedAt,o={topic:i,message:s,publishedAt:a},this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ar({type:"event",event:r.id},o)),this.events.emit(r.id,o),e.next=9,this.acknowledgePayload(t);case 9:return e.next=11,this.onMessageEvent(o);case 11:e.next=14;break;case 13:(0,P.isJsonRpcResponse)(t)&&this.events.emit(wt.message_ack,t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onMessageEvent",value:(i=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.shouldIgnoreMessageEvent(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return this.events.emit(wt.message,t),e.next=7,this.recordMessageEvent(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"acknowledgePayload",value:(r=(0,c.Z)(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,P.formatJsonRpcResult)(t.id,!0),e.next=3,this.provider.connection.send(r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"registerProviderListeners",value:function(){var e=this;this.provider.on(kt,(function(t){return e.onProviderPayload(t)})),this.provider.on(Et,(function(){e.events.emit(wt.connect)})),this.provider.on(It,(function(){e.onProviderDisconnect()})),this.provider.on(Zt,(function(t){e.logger.error(t),e.events.emit(wt.error,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.events.on(wt.connection_stalled,(0,c.Z)(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))))}},{key:"onProviderDisconnect",value:function(){this.events.emit(wt.disconnect),this.attemptToReconnect()}},{key:"attemptToReconnect",value:function(){var e=this;this.transportExplicitlyClosed||setTimeout((0,c.Z)(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))),(0,I.toMiliseconds)(Pt))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"toEstablishConnection",value:(t=(0,c.Z)(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=7;break}if(!this.connecting){e.next=5;break}return e.next=4,new Promise((function(e){var r=setInterval((function(){t.connected&&(clearInterval(r),e())}),t.connectionStatusPollingInterval)}));case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.restartTransport();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),T}(m.oe),cr=Object.defineProperty,ur=Object.getOwnPropertySymbols,pr=Object.prototype.hasOwnProperty,lr=Object.prototype.propertyIsEnumerable,hr=function(e,t,r){return t in e?cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},fr=function(e,t){for(var r in t||(t={}))pr.call(t,r)&&hr(e,r,t[r]);if(ur){var n,i=O(ur(t));try{for(i.s();!(n=i.n()).done;){r=n.value;lr.call(t,r)&&hr(e,r,t[r])}}catch(s){i.e(s)}finally{i.f()}}return e},gr=function(e){(0,s.Z)(o,e);var t,r,n,i,a=R(o);function o(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ht,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return(0,p.Z)(this,o),(n=a.call(this,e,t,r,i)).core=e,n.logger=t,n.name=r,n.map=new Map,n.version="0.3",n.cached=[],n.initialized=!1,n.storagePrefix=ht,n.init=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.initialized,e.t0){e.next=8;break}return n.logger.trace("Initialized"),e.next=5,n.restore();case 5:n.cached.forEach((function(e){n.getKey&&null!==e&&!(0,k.o8)(e)?n.map.set(n.getKey(e),e):(0,k.xW)(e)?n.map.set(e.id,e):(0,k.h1)(e)&&n.map.set(e.topic,e)})),n.cached=[],n.initialized=!0;case 8:case"end":return e.stop()}}),e)}))),n.set=function(){var e=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isInitialized(),!n.map.has(t)){e.next=6;break}return e.next=4,n.update(t,r);case 4:e.next=11;break;case 6:return n.logger.debug("Setting value"),n.logger.trace({type:"method",method:"set",key:t,value:r}),n.map.set(t,r),e.next=11,n.persist();case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.get=function(e){return n.isInitialized(),n.logger.debug("Getting value"),n.logger.trace({type:"method",method:"get",key:e}),n.getData(e)},n.getAll=function(e){return n.isInitialized(),e?n.values.filter((function(t){return Object.keys(e).every((function(r){return T()(t[r],e[r])}))})):n.values},n.update=function(){var e=(0,c.Z)(f().mark((function e(t,r){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),n.logger.debug("Updating value"),n.logger.trace({type:"method",method:"update",key:t,update:r}),i=fr(fr({},n.getData(t)),r),n.map.set(t,i),e.next=5,n.persist();case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.delete=function(){var e=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isInitialized(),e.t0=n.map.has(t),!e.t0){e.next=8;break}return n.logger.debug("Deleting value"),n.logger.trace({type:"method",method:"delete",key:t,reason:r}),n.map.delete(t),e.next=8,n.persist();case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.logger=(0,b.generateChildLogger)(t,n.name),n.storagePrefix=i,n.getKey=s,n}return(0,l.Z)(o,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.map.size}},{key:"keys",get:function(){return Array.from(this.map.keys())}},{key:"values",get:function(){return Array.from(this.map.values())}},{key:"setDataStore",value:(i=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getDataStore",value:(n=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getData",value:function(e){var t=this.map.get(e);if(!t){var r=(0,k.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(r),new Error(r)}return t}},{key:"persist",value:(r=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setDataStore(this.values);case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"restore",value:(t=(0,c.Z)(f().mark((function e(){var t,r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getDataStore();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.map.size){e.next=9;break}throw r=(0,k.Z7)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored value for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",value:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore value for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),o}(m.pZ),dr=function(){function e(t,r){var n=this;(0,p.Z)(this,e),this.core=t,this.logger=r,this.name="pairing",this.version="0.3",this.events=new(d()),this.initialized=!1,this.storagePrefix=ht,this.ignoredPayloadTypes=[k.rV],this.registeredMethods=[],this.init=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.initialized,e.t0){e.next=10;break}return e.next=4,n.pairings.init();case 4:return e.next=6,n.cleanup();case 6:n.registerRelayerEvents(),n.registerExpirerEvents(),n.initialized=!0,n.logger.trace("Initialized");case 10:case"end":return e.stop()}}),e)}))),this.register=function(e){var t=e.methods;n.isInitialized(),n.registeredMethods=(0,i.Z)(new Set([].concat((0,i.Z)(n.registeredMethods),(0,i.Z)(t))))},this.create=(0,c.Z)(f().mark((function e(){var t,r,i,s,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),t=(0,k.jd)(),e.next=4,n.core.crypto.setSymKey(t);case 4:return r=e.sent,i=(0,k.gn)(I.FIVE_MINUTES),a={topic:r,expiry:i,relay:s={protocol:bt},active:!1},o=(0,k.Bv)({protocol:n.core.protocol,version:n.core.version,topic:r,symKey:t,relay:s}),e.next=11,n.pairings.set(r,a);case 11:return e.next=13,n.core.relayer.subscribe(r);case 13:return n.core.expirer.set(r,i),e.abrupt("return",{topic:r,uri:o});case 15:case"end":return e.stop()}}),e)}))),this.pair=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i,s,a,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isInitialized(),n.isValidPair(t),r=(0,k.he)(t.uri),i=r.topic,s=r.symKey,a=r.relay,!n.pairings.keys.includes(i)){e.next=4;break}throw new Error("Pairing already exists: ".concat(i));case 4:if(!n.core.crypto.hasKeys(i)){e.next=6;break}throw new Error("Keychain already exists: ".concat(i));case 6:return o=(0,k.gn)(I.FIVE_MINUTES),c={topic:i,relay:a,expiry:o,active:!1},e.next=9,n.pairings.set(i,c);case 9:return e.next=11,n.core.crypto.setSymKey(s,i);case 11:return e.next=13,n.core.relayer.subscribe(i,{relay:a});case 13:if(n.core.expirer.set(i,o),e.t0=t.activatePairing,!e.t0){e.next=18;break}return e.next=18,n.activate({topic:i});case 18:return e.abrupt("return",c);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.activate=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,n.isInitialized(),i=(0,k.gn)(I.THIRTY_DAYS),e.next=5,n.pairings.update(r,{active:!0,expiry:i});case 5:n.core.expirer.set(r,i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.ping=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i,s,a,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidPing(t);case 3:if(r=t.topic,!n.pairings.keys.includes(r)){e.next=15;break}return e.next=7,n.sendRequest(r,"wc_pairingPing",{});case 7:return i=e.sent,s=(0,k.H1)(),a=s.done,o=s.resolve,c=s.reject,n.events.once((0,k.E0)("pairing_ping",i),(function(e){var t=e.error;t?c(t):o()})),e.next=15,a();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateExpiry=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.expiry,n.isInitialized(),e.next=4,n.pairings.update(r,{expiry:i});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateMetadata=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.metadata,n.isInitialized(),e.next=4,n.pairings.update(r,{peerMetadata:i});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPairings=function(){return n.isInitialized(),n.pairings.values},this.disconnect=function(){var e=(0,c.Z)(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isInitialized(),e.next=3,n.isValidDisconnect(t);case 3:if(r=t.topic,e.t0=n.pairings.keys.includes(r),!e.t0){e.next=10;break}return e.next=8,n.sendRequest(r,"wc_pairingDelete",(0,k.D6)("USER_DISCONNECTED"));case 8:return e.next=10,n.deletePairing(r);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendRequest=function(){var e=(0,c.Z)(f().mark((function e(t,r,i){var s,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,P.formatJsonRpcRequest)(r,i),e.next=3,n.core.crypto.encode(t,s);case 3:return a=e.sent,o=zt[r].req,e.abrupt("return",(n.core.history.set(t,s),n.core.relayer.publish(t,a,o),s.id));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.sendResult=function(){var e=(0,c.Z)(f().mark((function e(t,r,i){var s,a,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,P.formatJsonRpcResult)(t,i),e.next=3,n.core.crypto.encode(r,s);case 3:return a=e.sent,e.next=6,n.core.history.get(r,t);case 6:return o=e.sent,c=zt[o.request.method].res,e.next=10,n.core.relayer.publish(r,a,c);case 10:return e.next=12,n.core.history.resolve(s);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.sendError=function(){var e=(0,c.Z)(f().mark((function e(t,r,i){var s,a,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,P.formatJsonRpcError)(t,i),e.next=3,n.core.crypto.encode(r,s);case 3:return a=e.sent,e.next=6,n.core.history.get(r,t);case 6:return o=e.sent,c=zt[o.request.method]?zt[o.request.method].res:zt.unregistered_method.res,e.next=10,n.core.relayer.publish(r,a,c);case 10:return e.next=12,n.core.history.resolve(s);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),this.deletePairing=function(){var e=(0,c.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.core.relayer.unsubscribe(t);case 2:return e.next=4,Promise.all([n.pairings.delete(t,(0,k.D6)("USER_DISCONNECTED")),n.core.crypto.deleteSymKey(t),r?Promise.resolve():n.core.expirer.del(t)]);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.cleanup=(0,c.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.pairings.getAll().filter((function(e){return(0,k.Bw)(e.expiry)})),e.next=3,Promise.all(t.map((function(e){return n.deletePairing(e.topic)})));case 3:case"end":return e.stop()}}),e)}))),this.onRelayEventRequest=function(e){var t=e.topic,r=e.payload;switch(r.method){case"wc_pairingPing":return n.onPairingPingRequest(t,r);case"wc_pairingDelete":return n.onPairingDeleteRequest(t,r);default:return n.onUnknownRpcMethodRequest(t,r)}},this.onRelayEventResponse=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.topic,i=t.payload,e.next=4,n.core.history.get(r,i.id);case 4:s=e.sent.request.method,e.t0=s,e.next="wc_pairingPing"===e.t0?8:9;break;case 8:return e.abrupt("return",n.onPairingPingResponse(r,i));case 9:return e.abrupt("return",n.onUnknownRpcMethodResponse(s));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onPairingPingRequest=function(){var e=(0,c.Z)(f().mark((function e(t,r){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidPing({topic:t}),e.next=5,n.sendResult(i,t,!0);case 5:n.events.emit("pairing_ping",{id:i,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(i,t,e.t0);case 12:n.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onPairingPingResponse=function(e,t){var r=t.id;setTimeout((function(){(0,P.isJsonRpcResult)(t)?n.events.emit((0,k.E0)("pairing_ping",r),{}):(0,P.isJsonRpcError)(t)&&n.events.emit((0,k.E0)("pairing_ping",r),{error:t.error})}),500)},this.onPairingDeleteRequest=function(){var e=(0,c.Z)(f().mark((function e(t,r){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,e.prev=1,n.isValidDisconnect({topic:t}),e.next=5,n.deletePairing(t);case 5:n.events.emit("pairing_delete",{id:i,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,n.sendError(i,t,e.t0);case 12:n.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodRequest=function(){var e=(0,c.Z)(f().mark((function e(t,r){var i,s,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.id,s=r.method,e.prev=1,!n.registeredMethods.includes(s)){e.next=4;break}return e.abrupt("return");case 4:return a=(0,k.D6)("WC_METHOD_UNSUPPORTED",s),e.next=7,n.sendError(i,t,a);case 7:n.logger.error(a),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,n.sendError(i,t,e.t0);case 14:n.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodResponse=function(e){n.registeredMethods.includes(e)||n.logger.error((0,k.D6)("WC_METHOD_UNSUPPORTED",e))},this.isValidPair=function(e){if(!(0,k.EJ)(e)){var t=(0,k.Z7)("MISSING_OR_INVALID","pair() params: ".concat(e)).message;throw new Error(t)}if(!(0,k.jv)(e.uri)){var r=(0,k.Z7)("MISSING_OR_INVALID","pair() uri: ".concat(e.uri)).message;throw new Error(r)}},this.isValidPing=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,k.EJ)(t)){e.next=3;break}throw r=(0,k.Z7)("MISSING_OR_INVALID","ping() params: ".concat(t)),i=r.message,new Error(i);case 3:return s=t.topic,e.next=6,n.isValidPairingTopic(s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidDisconnect=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,k.EJ)(t)){e.next=3;break}throw r=(0,k.Z7)("MISSING_OR_INVALID","disconnect() params: ".concat(t)),i=r.message,new Error(i);case 3:return s=t.topic,e.next=6,n.isValidPairingTopic(s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidPairingTopic=function(){var e=(0,c.Z)(f().mark((function e(t){var r,i,s,a,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,k.M_)(t,!1)){e.next=3;break}throw r=(0,k.Z7)("MISSING_OR_INVALID","pairing topic should be a string: ".concat(t)),i=r.message,new Error(i);case 3:if(n.pairings.keys.includes(t)){e.next=6;break}throw s=(0,k.Z7)("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(t)),a=s.message,new Error(a);case 6:if(!(0,k.Bw)(n.pairings.get(t).expiry)){e.next=11;break}return e.next=9,n.deletePairing(t);case 9:throw o=(0,k.Z7)("EXPIRED","pairing topic: ".concat(t)),c=o.message,new Error(c);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,b.generateChildLogger)(r,this.name),this.pairings=new gr(this.core,this.logger,this.name,this.storagePrefix)}return(0,l.Z)(e,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"registerRelayerEvents",value:function(){var e=this;this.core.relayer.on(wt.message,function(){var t=(0,c.Z)(f().mark((function t(r){var n,i,s;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.topic,i=r.message,e.pairings.keys.includes(n)&&!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(i))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.core.crypto.decode(n,i);case 5:if(s=t.sent,t.prev=6,!(0,P.isJsonRpcRequest)(s)){t.next=11;break}e.core.history.set(n,s),e.onRelayEventRequest({topic:n,payload:s}),t.next=18;break;case 11:if(t.t0=(0,P.isJsonRpcResponse)(s),!t.t0){t.next=18;break}return t.next=15,e.core.history.resolve(s);case 15:return t.next=17,e.onRelayEventResponse({topic:n,payload:s});case 17:e.core.history.delete(n,s.id);case 18:t.next=23;break;case 20:t.prev=20,t.t1=t.catch(6),e.logger.error(t.t1);case 23:case"end":return t.stop()}}),t,null,[[6,20]])})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerExpirerEvents",value:function(){var e=this;this.core.expirer.on(Nt.expired,function(){var t=(0,c.Z)(f().mark((function t(r){var n,i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,k.iP)(r.target),i=n.topic,t.t0=i&&e.pairings.keys.includes(i),!t.t0){t.next=6;break}return t.next=5,e.deletePairing(i,!0);case 5:e.events.emit("pairing_expire",{topic:i});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),e}(),vr=function(e){(0,s.Z)(o,e);var t,r,n,i,a=R(o);function o(e,t){var r;return(0,p.Z)(this,o),(r=a.call(this,e,t)).core=e,r.logger=t,r.records=new Map,r.events=new g.EventEmitter,r.name="history",r.version="0.3",r.cached=[],r.initialized=!1,r.storagePrefix=ht,r.init=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=9;break}return r.logger.trace("Initialized"),e.next=5,r.restore();case 5:r.cached.forEach((function(e){return r.records.set(e.id,e)})),r.cached=[],r.registerEventListeners(),r.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),r.set=function(e,t,n){if(r.isInitialized(),r.logger.debug("Setting JSON-RPC request history record"),r.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:n}),!r.records.has(t.id)){var i={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n,expiry:(0,k.gn)(I.THIRTY_DAYS)};r.records.set(i.id,i),r.events.emit(Ct,i)}},r.resolve=function(){var e=(0,c.Z)(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),r.logger.debug("Updating JSON-RPC response history record"),r.logger.trace({type:"method",method:"update",response:t}),r.records.has(t.id)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.getRecord(t.id);case 4:typeof(n=e.sent).response>"u"&&(n.response=(0,P.isJsonRpcError)(t)?{error:t.error}:{result:t.result},r.records.set(n.id,n),r.events.emit(At,n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.get=function(){var e=(0,c.Z)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.logger.debug("Getting record"),r.logger.trace({type:"method",method:"get",topic:t,id:n}),e.next=5,r.getRecord(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.delete=function(e,t){r.isInitialized(),r.logger.debug("Deleting record"),r.logger.trace({type:"method",method:"delete",id:t}),r.values.forEach((function(n){if(n.topic===e){if(typeof t<"u"&&n.id!==t)return;r.records.delete(n.id),r.events.emit(Dt,n)}}))},r.exists=function(){var e=(0,c.Z)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),!r.records.has(n)){e.next=9;break}return e.next=4,r.getRecord(n);case 4:e.t1=e.sent.topic,e.t2=t,e.t0=e.t1===e.t2,e.next=10;break;case 9:e.t0=!1;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.on=function(e,t){r.events.on(e,t)},r.once=function(e,t){r.events.once(e,t)},r.off=function(e,t){r.events.off(e,t)},r.removeListener=function(e,t){r.events.removeListener(e,t)},r.logger=(0,b.generateChildLogger)(t,r.name),r}return(0,l.Z)(o,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"size",get:function(){return this.records.size}},{key:"keys",get:function(){return Array.from(this.records.keys())}},{key:"values",get:function(){return Array.from(this.records.values())}},{key:"pending",get:function(){var e=[];return this.values.forEach((function(t){if(!(typeof t.response<"u")){var r={topic:t.topic,request:(0,P.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}})),e}},{key:"setJsonRpcRecords",value:(i=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getJsonRpcRecords",value:(n=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getRecord",value:function(e){this.isInitialized();var t=this.records.get(e);if(!t){var r=(0,k.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(r)}return t}},{key:"persist",value:(r=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setJsonRpcRecords(this.values);case 2:this.events.emit(Lt);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"restore",value:(t=(0,c.Z)(f().mark((function e(){var t,r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getJsonRpcRecords();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.records.size){e.next=9;break}throw r=(0,k.Z7)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",records:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"registerEventListeners",value:function(){var e=this;this.events.on(Ct,(function(t){var r=Ct;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.events.on(At,(function(t){var r=At;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.events.on(Dt,(function(t){var r=Dt;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,record:t}),e.persist()})),this.core.heartbeat.on(y.HEARTBEAT_EVENTS.pulse,(function(){e.cleanup()}))}},{key:"cleanup",value:function(){var e=this;try{this.records.forEach((function(t){(0,I.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(e.logger.info("Deleting expired history log: ".concat(t.id)),e.delete(t.topic,t.id))}))}catch(t){this.logger.warn(t)}}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),o}(m.yy),yr=function(e){(0,s.Z)(o,e);var t,r,n,i,a=R(o);function o(e,t){var r;return(0,p.Z)(this,o),(r=a.call(this,e,t)).core=e,r.logger=t,r.expirations=new Map,r.events=new g.EventEmitter,r.name="expirer",r.version="0.3",r.cached=[],r.initialized=!1,r.storagePrefix=ht,r.init=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=9;break}return r.logger.trace("Initialized"),e.next=5,r.restore();case 5:r.cached.forEach((function(e){return r.expirations.set(e.target,e)})),r.cached=[],r.registerEventListeners(),r.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),r.has=function(e){try{var t=r.formatTarget(e);return typeof r.getExpiration(t)<"u"}catch(n){return!1}},r.set=function(e,t){r.isInitialized();var n=r.formatTarget(e),i={target:n,expiry:t};r.expirations.set(n,i),r.checkExpiry(n,i),r.events.emit(Nt.created,{target:n,expiration:i})},r.get=function(e){r.isInitialized();var t=r.formatTarget(e);return r.getExpiration(t)},r.del=function(e){if(r.isInitialized(),r.has(e)){var t=r.formatTarget(e),n=r.getExpiration(t);r.expirations.delete(t),r.events.emit(Nt.deleted,{target:t,expiration:n})}},r.on=function(e,t){r.events.on(e,t)},r.once=function(e,t){r.events.once(e,t)},r.off=function(e,t){r.events.off(e,t)},r.removeListener=function(e,t){r.events.removeListener(e,t)},r.logger=(0,b.generateChildLogger)(t,r.name),r}return(0,l.Z)(o,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.expirations.size}},{key:"keys",get:function(){return Array.from(this.expirations.keys())}},{key:"values",get:function(){return Array.from(this.expirations.values())}},{key:"formatTarget",value:function(e){if("string"==typeof e)return(0,k.Z4)(e);if("number"==typeof e)return(0,k.Gq)(e);var t=(0,k.Z7)("UNKNOWN_TYPE","Target type: ".concat(typeof e)).message;throw new Error(t)}},{key:"setExpirations",value:(i=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getExpirations",value:(n=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"persist",value:(r=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setExpirations(this.values);case 2:this.events.emit(Nt.sync);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"restore",value:(t=(0,c.Z)(f().mark((function e(){var t,r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getExpirations();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.expirations.size){e.next=9;break}throw r=(0,k.Z7)("RESTORE_WILL_OVERRIDE",this.name),n=r.message,this.logger.error(n),new Error(n);case 9:this.cached=t,this.logger.debug("Successfully Restored expirations for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",expirations:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore expirations for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return t.apply(this,arguments)})},{key:"getExpiration",value:function(e){var t=this.expirations.get(e);if(!t){var r=(0,k.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(r),new Error(r)}return t}},{key:"checkExpiry",value:function(e,t){var r=t.expiry;(0,I.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}},{key:"expire",value:function(e,t){this.expirations.delete(e),this.events.emit(Nt.expired,{target:e,expiration:t})}},{key:"checkExpirations",value:function(){var e=this;this.core.relayer.connected&&this.expirations.forEach((function(t,r){return e.checkExpiry(r,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.core.heartbeat.on(y.HEARTBEAT_EVENTS.pulse,(function(){return e.checkExpirations()})),this.events.on(Nt.created,(function(t){var r=Nt.created;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()})),this.events.on(Nt.expired,(function(t){var r=Nt.expired;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()})),this.events.on(Nt.deleted,(function(t){var r=Nt.deleted;e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,k.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),o}(m.D3),br=function(e){(0,s.Z)(r,e);var t=R(r);function r(e,n){var i;return(0,p.Z)(this,r),(i=t.call(this,e,n)).projectId=e,i.logger=n,i.name=Ut,i.initialized=!1,i.init=function(){var e=(0,c.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(0,k.b$)()||!(0,k.jU)(),e.t0){e.next=5;break}return i.verifyUrl=(null==t?void 0:t.verifyUrl)||Mt,e.next=5,i.createIframe();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.register=function(){var e=(0,c.Z)(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.initialized,e.t0){e.next=4;break}return e.next=4,i.init();case 4:if(!i.iframe){e.next=6;break}try{null==(r=i.iframe.contentWindow)||r.postMessage(t.attestationId,i.verifyUrl),i.logger.info("postMessage sent: ".concat(t.attestationId," ").concat(i.verifyUrl))}catch(n){}case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.resolve=function(){var e=(0,c.Z)(f().mark((function e(t){var r,n,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.isDevEnv){e.next=2;break}return e.abrupt("return","");case 2:return i.logger.info("resolving attestation: ".concat(t.attestationId)),n=i.startAbortTimer(I.FIVE_SECONDS),e.next=6,fetch("".concat(i.verifyUrl,"/attestation/").concat(t.attestationId),{signal:i.abortController.signal});case 6:if(s=e.sent,clearTimeout(n),200!==s.status){e.next=20;break}return e.next=11,s.json();case 11:if(e.t1=r=e.sent,null!=e.t1){e.next=16;break}e.t2=void 0,e.next=17;break;case 16:e.t2=r.origin;case 17:e.t0=e.t2,e.next=21;break;case 20:e.t0="";case 21:return e.abrupt("return",e.t0);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.createIframe=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.race([new Promise((function(e,t){if(document.getElementById(Ut))return e();var r=document.createElement("iframe");r.setAttribute("id",Ut),r.setAttribute("src","".concat(i.verifyUrl,"/").concat(i.projectId)),r.style.display="none",r.addEventListener("load",(function(){i.initialized=!0,e()})),r.addEventListener("error",(function(e){t(e)})),document.body.append(r),i.iframe=r})),new Promise((function(e){setTimeout((function(){return e("iframe load timeout")}),(0,I.toMiliseconds)(I.ONE_SECOND/2))}))]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i.logger.error("Verify iframe failed to load: ".concat(i.verifyUrl)),i.logger.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),i.logger=(0,b.generateChildLogger)(n,i.name),i.verifyUrl=Mt,i.abortController=new AbortController,i.isDevEnv=(0,k.UG)()&&{}.IS_VITEST,i}return(0,l.Z)(r,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"startAbortTimer",value:function(e){var t=this;return setTimeout((function(){return t.abortController.abort()}),(0,I.toMiliseconds)(e))}}]),r}(m.Yo),mr=Object.defineProperty,xr=Object.getOwnPropertySymbols,wr=Object.prototype.hasOwnProperty,kr=Object.prototype.propertyIsEnumerable,Er=function(e,t,r){return t in e?mr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},Ir=function(e,t){for(var r in t||(t={}))wr.call(t,r)&&Er(e,r,t[r]);if(xr){var n,i=O(xr(t));try{for(i.s();!(n=i.n()).done;){r=n.value;kr.call(t,r)&&Er(e,r,t[r])}}catch(s){i.e(s)}finally{i.f()}}return e},Zr=function(e){(0,s.Z)(o,e);var t,r,i,a=R(o);function o(e){var t;(0,p.Z)(this,o),(t=a.call(this,e)).protocol="wc",t.version=2,t.name=lt,t.events=new g.EventEmitter,t.initialized=!1,t.on=function(e,r){return t.events.on(e,r)},t.once=function(e,r){return t.events.once(e,r)},t.off=function(e,r){return t.events.off(e,r)},t.removeListener=function(e,r){return t.events.removeListener(e,r)},t.projectId=null==e?void 0:e.projectId,t.relayUrl=(null==e?void 0:e.relayUrl)||mt;var r=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:(0,b.pino)((0,b.getDefaultLoggerOptions)({level:(null==e?void 0:e.logger)||ft}));return t.logger=(0,b.generateChildLogger)(r,t.name),t.heartbeat=new y.HeartBeat,t.crypto=new Kt((0,n.Z)(t),t.logger,null==e?void 0:e.keychain),t.history=new vr((0,n.Z)(t),t.logger),t.expirer=new yr((0,n.Z)(t),t.logger),t.storage=null!=e&&e.storage?e.storage:new v.ZP(Ir(Ir({},gt),null==e?void 0:e.storageOptions)),t.relayer=new or({core:(0,n.Z)(t),logger:t.logger,relayUrl:t.relayUrl,projectId:t.projectId}),t.pairing=new dr((0,n.Z)(t),t.logger),t.verify=new br(t.projectId||"",t.logger),t}return(0,l.Z)(o,[{key:"context",get:function(){return(0,b.getLoggerContext)(this.logger)}},{key:"start",value:(i=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"initialize",value:(r=(0,c.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.prev=1,e.next=4,this.crypto.init();case 4:return e.next=6,this.history.init();case 6:return e.next=8,this.expirer.init();case 8:return e.next=10,this.relayer.init();case 10:return e.next=12,this.heartbeat.init();case 12:return e.next=14,this.pairing.init();case 14:this.initialized=!0,this.logger.info("Core Initialization Success"),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(1),this.logger.warn("Core Initialization Failure at epoch ".concat(Date.now()),e.t0),this.logger.error(e.t0.message),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,18]])}))),function(){return r.apply(this,arguments)})}],[{key:"init",value:(t=(0,c.Z)(f().mark((function e(t){var r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new o(t),e.next=3,r.initialize();case 3:return e.next=5,r.crypto.getClientId();case 5:return n=e.sent,e.next=8,r.storage.setItem("WALLETCONNECT_CLIENT_ID",n);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),o}(m.N1),Pr=Zr}}]);
//# sourceMappingURL=354803f7-568d25fc31bb3c91500d.js.map