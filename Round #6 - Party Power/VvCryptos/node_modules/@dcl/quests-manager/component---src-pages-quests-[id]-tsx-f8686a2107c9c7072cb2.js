"use strict";(self.webpackChunk_dcl_quests_manager=self.webpackChunk_dcl_quests_manager||[]).push([[411],{3464:function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Checkbox=void 0;var i=n(71256);Object.defineProperty(t,"Checkbox",{enumerable:!0,get:function(){return a(i).default}}),n(84791)},62886:function(e,t,n){n.d(t,{B:function(){return s}});var a=n(67294),i=n(48190),r=n.n(i),o=n(84092),s=function(e){var t=e.initialNodes,i=e.initialEdges,s=e.type,l=void 0===s?"new":s,u=e.onClick,c=e.close,d=r()((function(){return Promise.all([n.e(532),n.e(774),n.e(241),n.e(351),n.e(440),n.e(649)]).then(n.bind(n,10115))}))[0];return a.createElement("div",{style:{height:"100vh",width:"100vw"}},d&&a.createElement(d.QuestsDesigner,{saveDesignButton:"old"!==l&&u?{content:"new"==l?"Save Draft":"draft"==l?"Update Draft":"Update Quest",onClick:u,validate:"published"==l}:void 0,backButton:function(){return c?c():(0,o.back)()},initialNodes:t,initialEdges:i}))}},72660:function(e,t,n){n.d(t,{I:function(){return m}});n(38559);var a=n(93433),i=n(67294),r=n(389),o=n(3464),s=n(5765),l=n(3558),u=n(73355),c=function(e){var t=e.items,n=e.onSaveItem,a=(0,i.useState)(null),o=a[0],s=a[1],l=(0,i.useState)(null),u=l[0],c=l[1];return u?i.createElement(d,{item:u,onChange:function(e,t){var n;return c(Object.assign({},u,((n={})[e]=t,n)))},onClose:function(){return c(null)},onSave:function(){n(u,u.index),c(null)}}):o?i.createElement(d,{item:o,onChange:function(e,t){var n;return s(Object.assign({},o,((n={})[e]=t,n)))},onClose:function(){return s(null)},onSave:function(){n(o,-1),s(null)}}):i.createElement("div",{style:{display:"flex",flexDirection:"column",marginTop:"20px",marginBottom:"20px"}},i.createElement("h4",null,"Reward Items ",i.createElement("span",{style:{color:"var(--primary)"}},"*")),t.length?i.createElement("ul",null,t.map((function(e,t){return i.createElement(r.Button,{size:"small",type:"button",content:""+e.name,inverted:!0,onClick:function(){return c(Object.assign({},e,{index:t}))}})}))):i.createElement("p",null,"No items"),i.createElement(r.Button,{type:"button",content:"Add item",size:"small",inverted:!0,style:{border:"none",width:"20px"},onClick:function(){return s({name:"",imageLink:""})}}))},d=function(e){var t=e.item,n=e.onSave,a=e.onClose,o=e.onChange;return i.createElement("div",{style:{width:"100%",marginTop:"20px"}},i.createElement("h4",null,"Adding Item"),i.createElement("div",{style:{display:"flex",maxWidth:"100%",justifyContent:"space-between"},className:"key-value"},i.createElement(s.Field,{label:"name",value:t.name,onChange:function(e){return o("name",e.target.value)},error:t.name.length<3,message:t.name.length<3?"Name should be at least 3 chars":void 0}),i.createElement(s.Field,{label:"image link",value:t.imageLink,onChange:function(e){return o("imageLink",e.target.value)},error:!new RegExp(u.yV).test(t.imageLink||""),message:new RegExp(u.yV).test(t.imageLink||"")?void 0:"Image URL is invalud"})),i.createElement("div",{style:{display:"flex",justifyContent:"flex-start"}},i.createElement(r.Button,{type:"button",content:"Save",secondary:!0,size:"small",style:{maxWidth:"20px",marginRight:"10px"},disabled:(null==t?void 0:t.name.length)<3||""==(null==t?void 0:t.imageLink)||!new RegExp(u.yV).test(t.imageLink||""),onClick:function(){return n()}}),i.createElement(r.Button,{type:"button",content:"Close",inverted:!0,size:"small",style:{maxWidth:"20px"},onClick:function(){a()}})))},m=function(e){var t,n,d,m,v,g,h,p,f=e.onChange,y=e.quest,b=e.readonly,E=void 0!==b&&b;return i.createElement(i.Fragment,null,i.createElement("h3",null,"Quest Information"),i.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},i.createElement(l.Header,{sub:!0,size:"small"},i.createElement("label",null,"Name ",i.createElement("span",{style:{color:"var(--primary)"}},"*"))),i.createElement(s.Field,{placeholder:"Name of the quest",value:y.name,onChange:function(e){f(Object.assign({},y,{name:e.target.value}))},readOnly:E,error:!!(y.name&&(null===(t=y.name)||void 0===t?void 0:t.length)<5),message:y.name&&(null===(n=y.name)||void 0===n?void 0:n.length)<5?"Name should be at least 5 chars ":void 0}),i.createElement(l.Header,{sub:!0,size:"small"},i.createElement("label",null,"Description ",i.createElement("span",{style:{color:"var(--primary)"}},"*"))),i.createElement(s.Field,{placeholder:"Short description of the quest",value:y.description,onChange:function(e){f(Object.assign({},y,{description:e.target.value}))},readOnly:E,error:!!(y.description&&(null===(d=y.description)||void 0===d?void 0:d.length)<5),message:y.description&&(null===(m=y.description)||void 0===m?void 0:m.length)<5?"Description should be at least 5 chars ":void 0}),i.createElement(l.Header,{sub:!0,size:"small"},i.createElement("label",null,"Image ",i.createElement("span",{style:{color:"var(--primary)"}},"*"))),i.createElement(s.Field,{value:y.imageUrl,placeholder:"Image URL to display when listing the quest",onChange:function(e){f(Object.assign({},y,{imageUrl:e.target.value}))},readOnly:E,error:!!y.imageUrl&&!new RegExp(u.yV).test(y.imageUrl),message:!!y.imageUrl&&(new RegExp(u.yV).test(y.imageUrl)?void 0:"Image URL is invalid")})),i.createElement("div",null,i.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},i.createElement("div",null,i.createElement("h3",{style:{marginBottom:"0px"}},"Rewards")),i.createElement(o.Checkbox,{toggle:!0,checked:!!y.reward,onChange:function(){y.reward?f(Object.assign({},y,{reward:void 0})):f(Object.assign({},y,{reward:{hook:{webhookUrl:"",requestBody:{}},items:[]}}))}})),y.reward&&i.createElement(i.Fragment,null,i.createElement("p",{style:{fontSize:"10px",marginBottom:"10px",whiteSpace:"pre",color:"#676370"}},"Available placeholders for Webhook URL and Data to Receive (request body): ","\n","{ ",i.createElement("span",{style:{fontWeight:"bold"}},"quest_id"),"} , { ",i.createElement("span",{style:{fontWeight:"bold"}},"user_address"),"} ","\n","E.g: { beneficary: {user_address}, quest: {quest_id} }"),i.createElement("div",{style:{display:"flex",justifyContent:"space-between",flexDirection:"column",marginTop:"40px"}},i.createElement(l.Header,{sub:!0,size:"small"},i.createElement("label",null,"Webhook URL ",i.createElement("span",{style:{color:"var(--primary)"}},"*"))),i.createElement(s.Field,{value:(null==y||null===(v=y.reward)||void 0===v?void 0:v.hook.webhookUrl)||"",onChange:function(e){var t,n,a;f(Object.assign({},y,{reward:{items:(null===(t=y.reward)||void 0===t?void 0:t.items)||[],hook:{requestBody:(null===(n=y.reward)||void 0===n||null===(a=n.hook)||void 0===a?void 0:a.requestBody)||{},webhookUrl:e.target.value}}}))},placeholder:"URL to call when the quest is completed",readOnly:E,error:!new RegExp(u.yV).test(y.reward.hook.webhookUrl||""),message:new RegExp(u.yV).test(y.reward.hook.webhookUrl||"")?void 0:"Webhook URL is invalud"}),i.createElement("div",{style:{width:"100%"}},i.createElement(l.Header,{sub:!0,size:"small"},i.createElement("label",null,"Data to Receive"," ",i.createElement("span",{style:{color:"var(--primary)"}},"*"))),Object.entries((null==y||null===(g=y.reward)||void 0===g?void 0:g.hook.requestBody)||{}).length?Object.entries((null==y||null===(h=y.reward)||void 0===h?void 0:h.hook.requestBody)||{}).map((function(e,t){var n=e[0],a=e[1];return i.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"key-value"},i.createElement(s.Field,{value:n,onChange:function(e){var n,a,i,r=Object.entries((null===(n=y.reward)||void 0===n?void 0:n.hook.requestBody)||{});r[t][0]=e.target.value,f(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(a=y.reward)||void 0===a?void 0:a.hook.webhookUrl)||"",requestBody:Object.fromEntries(r)},items:(null===(i=y.reward)||void 0===i?void 0:i.items)||[]}}))},readOnly:E,error:!n.length,message:n.length?void 0:"Key cannot be empty"}),i.createElement("span",{style:{fontSize:"24px"}},":"),i.createElement(s.Field,{value:a,onChange:function(e){var n,a,i,r=Object.entries((null===(n=y.reward)||void 0===n?void 0:n.hook.requestBody)||{});r[t][1]=e.target.value,f(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(a=y.reward)||void 0===a?void 0:a.hook.webhookUrl)||"",requestBody:Object.fromEntries(r)},items:(null===(i=y.reward)||void 0===i?void 0:i.items)||[]}}))},readOnly:E,error:!a.length,message:a.length?void 0:"Value cannot be empty"}),!E&&i.createElement("button",{style:{color:"red",backgroundColor:"transparent",border:"none",cursor:"pointer"},onClick:function(){var e,t,a,i=Object.entries((null===(e=y.reward)||void 0===e?void 0:e.hook.requestBody)||{});f(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(t=y.reward)||void 0===t?void 0:t.hook.webhookUrl)||"",requestBody:Object.fromEntries(i.filter((function(e){return e[0]!=n})))},items:(null===(a=y.reward)||void 0===a?void 0:a.items)||[]}}))}},"âœ•"))})):null,!E&&i.createElement(r.Button,{type:"button",content:"Add Key:Value",size:"small",inverted:!0,style:{border:"none"},onClick:function(){var e,t,n,a,i,r=Object.keys((null===(e=y.reward)||void 0===e?void 0:e.hook.requestBody)||{});f(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(t=y.reward)||void 0===t?void 0:t.hook.webhookUrl)||"",requestBody:Object.assign({},(null===(n=y.reward)||void 0===n?void 0:n.hook.requestBody)||{},(a={},a["key"+(0==r.length?"":r.length)]="value",a))},items:(null===(i=y.reward)||void 0===i?void 0:i.items)||[]}}))}})),!E&&i.createElement(c,{items:(null==y||null===(p=y.reward)||void 0===p?void 0:p.items)||[],onSaveItem:function(e,t){var n,i,r,o,s=(0,a.Z)((null==y||null===(n=y.reward)||void 0===n?void 0:n.items)||[]);-1===t?s.push(e):s[t]=e,f(Object.assign({},y,{reward:{hook:{requestBody:(null===(i=y.reward)||void 0===i?void 0:i.hook.requestBody)||{},webhookUrl:(null===(r=y.reward)||void 0===r||null===(o=r.hook)||void 0===o?void 0:o.webhookUrl)||""},items:s}}))}})))))}},90796:function(e,t,n){n.r(t);var a=n(15861),i=n(93433),r=n(64687),o=n.n(r),s=n(67294),l=n(91285),u=n(72118),c=n(84092),d=n(37677),m=n(389),v=n(66687),g=n(57740),h=n(64328),p=n(4950),f=n(62886),y=n(72660),b=n(38026),E=n(73355),w=function(e){var t=e.type,n=e.onProceed,a=e.onCancel;return s.createElement(h.Modal,{open:!0,size:"tiny",className:"quests-modal"},s.createElement(h.Modal.Header,null,"activate"==t?"Activate":"Deactivate"," Quest"),s.createElement(h.Modal.Content,null,"activate"==t?"Players will be able to start the Quest again.":"Players will no longer be able to start the Quest. Players who have already started the Quest will be able to continue"),s.createElement(h.Modal.Actions,null,s.createElement(m.Button,{primary:!0,onClick:n,size:"medium"},"activate"==t?"Activate":"Deactivate"),s.createElement(m.Button,{onClick:a,size:"medium"},"Cancel")))};t.default=function(e){var t,n=e.id,r=(0,s.useState)(null),h=r[0],k=r[1],Q=(0,s.useState)(!1),x=Q[0],L=Q[1],C=(0,s.useState)([]),j=C[0],O=C[1],q=(0,u.useAuthContext)(),U=q[0],B=q[1],S=(0,s.useState)({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1}),z=S[0],R=S[1];if(U&&(t=new b.N(U)),(0,s.useEffect)((function(){U&&(t.getQuest(n).then((function(e){k(Object.assign({},e))})).catch(console.error),t.getOldVersions(n).then((function(e){var t=e.updates;return O((0,i.Z)(t))})).catch(console.error))}),[U,n]),!h)return s.createElement(g.Loader,{size:"massive",active:!0});if(!U||B.loading)return s.createElement(p.SignIn,{onConnect:function(){return B.select()},isConnecting:B.loading});if(x){var T=(0,l.tV)(h.definition),_=T.nodes,D=T.edges;return s.createElement(f.B,{type:"published",close:function(){return L(!1)},initialEdges:D,initialNodes:_,onClick:function(e,t,n){void 0!==typeof window&&(alert("Quest Definition saved"),k(Object.assign({},h,{definition:n})))}})}return z.updatingQuestLoading||z.activatingQuestLoading||z.deactivatingQuestLoading?s.createElement(g.Loader,{size:"massive",active:!0}):s.createElement(v.Container,null,s.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"flex-start"}},s.createElement("div",{style:{display:"flex",justifyContent:"flex-start",width:"45%"}},s.createElement(d.Back,{onClick:function(){return(0,c.back)()}}),s.createElement("div",{style:{marginLeft:"24px"}},s.createElement("h2",null,"Edit Quest"),s.createElement("p",null,"Quest ID: ",h.id))),s.createElement("div",{style:{display:"flex",justifyContent:"center",width:"55%"}},s.createElement(m.Button,{onClick:function(){return L(!0)}},"Edit Quest Steps"),s.createElement(m.Button,{type:"button",content:h.active?"Deactivate Quest":"Activate Quest",inverted:!0,style:{marginLeft:"10px"},size:"small",onClick:(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h.active?R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!0,deactivatingQuestLoading:!1}):R({updatingQuestLoading:!1,activatingQuest:!0,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1});case 1:case"end":return e.stop()}}),e)})))}))),s.createElement("div",{style:{width:"50%",marginLeft:"60px",marginTop:"20px"}},s.createElement(y.I,{quest:h,onChange:function(e){return k(Object.assign({},h,e))}})),s.createElement("div",{style:{marginTop:"20px",marginLeft:"60px"}},s.createElement("h3",null,"Previous Versions"),j.length>0?s.createElement("ul",{style:{listStyle:"none"}},j.map((function(e){return s.createElement("li",{key:e},s.createElement(c.Link,{href:E.Kl.oldQuest(e)},"- Quest ",e))}))):"No previous versions"),s.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"40px",marginBottom:"40px",marginLeft:"60px"}},s.createElement("div",null,s.createElement(m.Button,{type:"button",primary:!0,content:"Publish Changes",size:"small",onClick:(0,a.Z)(o().mark((function e(){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({updatingQuestLoading:!0,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1}),e.next=3,t.updateQuest(h.id,h);case 3:n=e.sent,a=n.quest_id,setTimeout((function(){R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1}),(0,c.navigate)(E.Kl.editPublishedQuest(a))}),2500);case 6:case"end":return e.stop()}}),e)})))}),s.createElement("p",{style:{fontSize:"10px",marginTop:"5px",whiteSpace:"pre",color:"#676370"}},"Update a published Quest will cause a new Quest version, ","\n","with new ID and this Quest will be deactivated and no longer updatable"))),z.activatingQuest&&s.createElement(w,{type:"activate",onProceed:(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!0,deactivatingQuest:!1,deactivatingQuestLoading:!1}),e.next=3,t.activateQuest(h.id);case 3:setTimeout((0,a.Z)(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1}),e.next=3,t.getQuest(h.id);case 3:n=e.sent,k(Object.assign({},n));case 5:case"end":return e.stop()}}),e)}))),1500);case 4:case"end":return e.stop()}}),e)}))),onCancel:function(){R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1})}}),z.deactivatingQuest&&s.createElement(w,{type:"deactivate",onProceed:(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!0}),e.next=3,t.deactivateQuest(h.id);case 3:setTimeout((0,a.Z)(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1}),e.next=3,t.getQuest(h.id);case 3:n=e.sent,k(Object.assign({},n));case 5:case"end":return e.stop()}}),e)}))),1500);case 4:case"end":return e.stop()}}),e)}))),onCancel:function(){R({updatingQuestLoading:!1,activatingQuest:!1,activatingQuestLoading:!1,deactivatingQuest:!1,deactivatingQuestLoading:!1})}}))}},38026:function(e,t,n){n.d(t,{N:function(){return g}});var a=n(15861),i=n(94578),r=n(64687),o=n.n(r),s=n(99389),l=n(18509),u=n.n(l),c=n(94012),d=n.n(c);function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var g=function(e){function t(n){var a;return(a=e.call(this,t.URL)||this).user=n,a}(0,i.Z)(t,e);var n=t.prototype;return n.getMyQuests=function(){return this.fetch("/creators/"+this.user+"/quests",this.options().method("GET").authorization({sign:!0}))},n.publishQuest=function(e){(0,s.NJ)(e);for(var t,n=m(e.definition.steps);!(t=n()).done;)for(var a,i=m(t.value.tasks);!(a=i()).done;)for(var r,o=m(a.value.actionItems);!(r=o()).done;){var l=r.value;for(var u in l.parameters)"string"!=typeof l.parameters[u]&&(l.parameters[u]=JSON.stringify(l.parameters[u]))}return this.fetch("/quests",this.options().method("POST").authorization({sign:!0}).json(e).metadata(e))},n.getQuest=function(){var e=(0,a.Z)(o().mark((function e(t){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch("/quests/"+t,this.options().method("GET").authorization({sign:!0}));case 2:return n=e.sent,a=null,e.prev=4,e.next=7,this.fetch("/quests/"+t+"/reward?with_hook=true",this.options().method("GET").authorization({sign:!0}));case 7:a=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.log(e.t0);case 13:return e.abrupt("return",Object.assign({},n.quest,{reward:a||void 0}));case 14:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}(),n.updateQuest=function(e,t){if(!t.name)throw new Error("Quest must have a name");return this.fetch("/quests/"+e,this.options().method("PUT").authorization({sign:!0}).json(t))},n.deactivateQuest=function(e){return this.fetch("/quests/"+e,this.options().method("DELETE").authorization({sign:!0}))},n.activateQuest=function(e){return this.fetch("/quests/"+e+"/activate",this.options().method("PUT").authorization({sign:!0}))},n.getOldVersions=function(e){return this.fetch("/quests/"+e+"/updates",this.options().method("GET"))},t}(u());g.URL=d()("QUESTS_SERVER_URL","https://quests.decentraland.org/api")},84791:function(e,t,n){n.r(t)}}]);
//# sourceMappingURL=component---src-pages-quests-[id]-tsx-f8686a2107c9c7072cb2.js.map