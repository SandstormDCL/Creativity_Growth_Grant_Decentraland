"use strict";(self.webpackChunk_dcl_quests_manager=self.webpackChunk_dcl_quests_manager||[]).push([[688],{3464:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Checkbox=void 0;var o=n(71256);Object.defineProperty(t,"Checkbox",{enumerable:!0,get:function(){return r(o).default}}),n(84791)},62886:function(e,t,n){n.d(t,{B:function(){return l}});var r=n(67294),o=n(48190),a=n.n(o),i=n(84092),l=function(e){var t=e.initialNodes,o=e.initialEdges,l=e.type,s=void 0===l?"new":l,u=e.onClick,d=e.close,c=a()((function(){return Promise.all([n.e(532),n.e(774),n.e(241),n.e(351),n.e(440),n.e(649)]).then(n.bind(n,10115))}))[0];return r.createElement("div",{style:{height:"100vh",width:"100vw"}},c&&r.createElement(c.QuestsDesigner,{saveDesignButton:"old"!==s&&u?{content:"new"==s?"Save Draft":"draft"==s?"Update Draft":"Update Quest",onClick:u,validate:"published"==s}:void 0,backButton:function(){return d?d():(0,i.back)()},initialNodes:t,initialEdges:o}))}},72660:function(e,t,n){n.d(t,{I:function(){return m}});n(38559);var r=n(93433),o=n(67294),a=n(389),i=n(3464),l=n(5765),s=n(3558),u=n(73355),d=function(e){var t=e.items,n=e.onSaveItem,r=(0,o.useState)(null),i=r[0],l=r[1],s=(0,o.useState)(null),u=s[0],d=s[1];return u?o.createElement(c,{item:u,onChange:function(e,t){var n;return d(Object.assign({},u,((n={})[e]=t,n)))},onClose:function(){return d(null)},onSave:function(){n(u,u.index),d(null)}}):i?o.createElement(c,{item:i,onChange:function(e,t){var n;return l(Object.assign({},i,((n={})[e]=t,n)))},onClose:function(){return l(null)},onSave:function(){n(i,-1),l(null)}}):o.createElement("div",{style:{display:"flex",flexDirection:"column",marginTop:"20px",marginBottom:"20px"}},o.createElement("h4",null,"Reward Items ",o.createElement("span",{style:{color:"var(--primary)"}},"*")),t.length?o.createElement("ul",null,t.map((function(e,t){return o.createElement(a.Button,{size:"small",type:"button",content:""+e.name,inverted:!0,onClick:function(){return d(Object.assign({},e,{index:t}))}})}))):o.createElement("p",null,"No items"),o.createElement(a.Button,{type:"button",content:"Add item",size:"small",inverted:!0,style:{border:"none",width:"20px"},onClick:function(){return l({name:"",imageLink:""})}}))},c=function(e){var t=e.item,n=e.onSave,r=e.onClose,i=e.onChange;return o.createElement("div",{style:{width:"100%",marginTop:"20px"}},o.createElement("h4",null,"Adding Item"),o.createElement("div",{style:{display:"flex",maxWidth:"100%",justifyContent:"space-between"},className:"key-value"},o.createElement(l.Field,{label:"name",value:t.name,onChange:function(e){return i("name",e.target.value)},error:t.name.length<3,message:t.name.length<3?"Name should be at least 3 chars":void 0}),o.createElement(l.Field,{label:"image link",value:t.imageLink,onChange:function(e){return i("imageLink",e.target.value)},error:!new RegExp(u.yV).test(t.imageLink||""),message:new RegExp(u.yV).test(t.imageLink||"")?void 0:"Image URL is invalud"})),o.createElement("div",{style:{display:"flex",justifyContent:"flex-start"}},o.createElement(a.Button,{type:"button",content:"Save",secondary:!0,size:"small",style:{maxWidth:"20px",marginRight:"10px"},disabled:(null==t?void 0:t.name.length)<3||""==(null==t?void 0:t.imageLink)||!new RegExp(u.yV).test(t.imageLink||""),onClick:function(){return n()}}),o.createElement(a.Button,{type:"button",content:"Close",inverted:!0,size:"small",style:{maxWidth:"20px"},onClick:function(){r()}})))},m=function(e){var t,n,c,m,h,v,f,g,p=e.onChange,y=e.quest,b=e.readonly,E=void 0!==b&&b;return o.createElement(o.Fragment,null,o.createElement("h3",null,"Quest Information"),o.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"}},o.createElement(s.Header,{sub:!0,size:"small"},o.createElement("label",null,"Name ",o.createElement("span",{style:{color:"var(--primary)"}},"*"))),o.createElement(l.Field,{placeholder:"Name of the quest",value:y.name,onChange:function(e){p(Object.assign({},y,{name:e.target.value}))},readOnly:E,error:!!(y.name&&(null===(t=y.name)||void 0===t?void 0:t.length)<5),message:y.name&&(null===(n=y.name)||void 0===n?void 0:n.length)<5?"Name should be at least 5 chars ":void 0}),o.createElement(s.Header,{sub:!0,size:"small"},o.createElement("label",null,"Description ",o.createElement("span",{style:{color:"var(--primary)"}},"*"))),o.createElement(l.Field,{placeholder:"Short description of the quest",value:y.description,onChange:function(e){p(Object.assign({},y,{description:e.target.value}))},readOnly:E,error:!!(y.description&&(null===(c=y.description)||void 0===c?void 0:c.length)<5),message:y.description&&(null===(m=y.description)||void 0===m?void 0:m.length)<5?"Description should be at least 5 chars ":void 0}),o.createElement(s.Header,{sub:!0,size:"small"},o.createElement("label",null,"Image ",o.createElement("span",{style:{color:"var(--primary)"}},"*"))),o.createElement(l.Field,{value:y.imageUrl,placeholder:"Image URL to display when listing the quest",onChange:function(e){p(Object.assign({},y,{imageUrl:e.target.value}))},readOnly:E,error:!!y.imageUrl&&!new RegExp(u.yV).test(y.imageUrl),message:!!y.imageUrl&&(new RegExp(u.yV).test(y.imageUrl)?void 0:"Image URL is invalid")})),o.createElement("div",null,o.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},o.createElement("div",null,o.createElement("h3",{style:{marginBottom:"0px"}},"Rewards")),o.createElement(i.Checkbox,{toggle:!0,checked:!!y.reward,onChange:function(){y.reward?p(Object.assign({},y,{reward:void 0})):p(Object.assign({},y,{reward:{hook:{webhookUrl:"",requestBody:{}},items:[]}}))}})),y.reward&&o.createElement(o.Fragment,null,o.createElement("p",{style:{fontSize:"10px",marginBottom:"10px",whiteSpace:"pre",color:"#676370"}},"Available placeholders for Webhook URL and Data to Receive (request body): ","\n","{ ",o.createElement("span",{style:{fontWeight:"bold"}},"quest_id"),"} , { ",o.createElement("span",{style:{fontWeight:"bold"}},"user_address"),"} ","\n","E.g: { beneficary: {user_address}, quest: {quest_id} }"),o.createElement("div",{style:{display:"flex",justifyContent:"space-between",flexDirection:"column",marginTop:"40px"}},o.createElement(s.Header,{sub:!0,size:"small"},o.createElement("label",null,"Webhook URL ",o.createElement("span",{style:{color:"var(--primary)"}},"*"))),o.createElement(l.Field,{value:(null==y||null===(h=y.reward)||void 0===h?void 0:h.hook.webhookUrl)||"",onChange:function(e){var t,n,r;p(Object.assign({},y,{reward:{items:(null===(t=y.reward)||void 0===t?void 0:t.items)||[],hook:{requestBody:(null===(n=y.reward)||void 0===n||null===(r=n.hook)||void 0===r?void 0:r.requestBody)||{},webhookUrl:e.target.value}}}))},placeholder:"URL to call when the quest is completed",readOnly:E,error:!new RegExp(u.yV).test(y.reward.hook.webhookUrl||""),message:new RegExp(u.yV).test(y.reward.hook.webhookUrl||"")?void 0:"Webhook URL is invalud"}),o.createElement("div",{style:{width:"100%"}},o.createElement(s.Header,{sub:!0,size:"small"},o.createElement("label",null,"Data to Receive"," ",o.createElement("span",{style:{color:"var(--primary)"}},"*"))),Object.entries((null==y||null===(v=y.reward)||void 0===v?void 0:v.hook.requestBody)||{}).length?Object.entries((null==y||null===(f=y.reward)||void 0===f?void 0:f.hook.requestBody)||{}).map((function(e,t){var n=e[0],r=e[1];return o.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"key-value"},o.createElement(l.Field,{value:n,onChange:function(e){var n,r,o,a=Object.entries((null===(n=y.reward)||void 0===n?void 0:n.hook.requestBody)||{});a[t][0]=e.target.value,p(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(r=y.reward)||void 0===r?void 0:r.hook.webhookUrl)||"",requestBody:Object.fromEntries(a)},items:(null===(o=y.reward)||void 0===o?void 0:o.items)||[]}}))},readOnly:E,error:!n.length,message:n.length?void 0:"Key cannot be empty"}),o.createElement("span",{style:{fontSize:"24px"}},":"),o.createElement(l.Field,{value:r,onChange:function(e){var n,r,o,a=Object.entries((null===(n=y.reward)||void 0===n?void 0:n.hook.requestBody)||{});a[t][1]=e.target.value,p(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(r=y.reward)||void 0===r?void 0:r.hook.webhookUrl)||"",requestBody:Object.fromEntries(a)},items:(null===(o=y.reward)||void 0===o?void 0:o.items)||[]}}))},readOnly:E,error:!r.length,message:r.length?void 0:"Value cannot be empty"}),!E&&o.createElement("button",{style:{color:"red",backgroundColor:"transparent",border:"none",cursor:"pointer"},onClick:function(){var e,t,r,o=Object.entries((null===(e=y.reward)||void 0===e?void 0:e.hook.requestBody)||{});p(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(t=y.reward)||void 0===t?void 0:t.hook.webhookUrl)||"",requestBody:Object.fromEntries(o.filter((function(e){return e[0]!=n})))},items:(null===(r=y.reward)||void 0===r?void 0:r.items)||[]}}))}},"âœ•"))})):null,!E&&o.createElement(a.Button,{type:"button",content:"Add Key:Value",size:"small",inverted:!0,style:{border:"none"},onClick:function(){var e,t,n,r,o,a=Object.keys((null===(e=y.reward)||void 0===e?void 0:e.hook.requestBody)||{});p(Object.assign({},y,{reward:{hook:{webhookUrl:(null===(t=y.reward)||void 0===t?void 0:t.hook.webhookUrl)||"",requestBody:Object.assign({},(null===(n=y.reward)||void 0===n?void 0:n.hook.requestBody)||{},(r={},r["key"+(0==a.length?"":a.length)]="value",r))},items:(null===(o=y.reward)||void 0===o?void 0:o.items)||[]}}))}})),!E&&o.createElement(d,{items:(null==y||null===(g=y.reward)||void 0===g?void 0:g.items)||[],onSaveItem:function(e,t){var n,o,a,i,l=(0,r.Z)((null==y||null===(n=y.reward)||void 0===n?void 0:n.items)||[]);-1===t?l.push(e):l[t]=e,p(Object.assign({},y,{reward:{hook:{requestBody:(null===(o=y.reward)||void 0===o?void 0:o.hook.requestBody)||{},webhookUrl:(null===(a=y.reward)||void 0===a||null===(i=a.hook)||void 0===i?void 0:i.webhookUrl)||""},items:l}}))}})))))}},19130:function(e,t,n){n.r(t);var r=n(67294),o=n(91285),a=n(72118),i=n(84092),l=n(37677),s=n(389),u=n(66687),d=n(4950),c=n(62886),m=n(72660),h=n(38026);t.default=function(e){var t,n=e.id,v=(0,r.useState)(null),f=v[0],g=v[1],p=(0,r.useState)(!1),y=p[0],b=p[1],E=(0,a.useAuthContext)(),w=E[0],k=E[1];if(w&&(t=new h.N(w)),(0,r.useEffect)((function(){w&&t.getQuest(n).then((function(e){g(Object.assign({},e))})).catch(console.error)}),[w]),!f)return r.createElement(u.Container,null,"Loading");if(!w||k.loading)return r.createElement(d.SignIn,{onConnect:function(){return k.select()},isConnecting:k.loading});if(y){var x=(0,o.tV)(f.definition),C=x.nodes,j=x.edges;return r.createElement(c.B,{type:"old",close:function(){return b(!1)},initialEdges:j,initialNodes:C})}return r.createElement(u.Container,null,r.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"flex-start"}},r.createElement("div",{style:{display:"flex",justifyContent:"flex-start",width:"45%"}},r.createElement(l.Back,{onClick:function(){return(0,i.back)()}}),r.createElement("div",{style:{marginLeft:"24px"}},r.createElement("h2",null,"View Quest"),r.createElement("p",null,"Quest ID: ",f.id))),r.createElement("div",{style:{display:"flex",justifyContent:"center",width:"55%"}},r.createElement(s.Button,{onClick:function(){return b(!0)},inverted:!0,style:{border:"none"}},"View Quest Steps"))),r.createElement("div",{style:{width:"50%",paddingTop:"20px",marginLeft:"60px"}},r.createElement(m.I,{quest:f,readonly:!0,onChange:function(e){return g(Object.assign({},f,e))}})))}},38026:function(e,t,n){n.d(t,{N:function(){return v}});var r=n(15861),o=n(94578),a=n(64687),i=n.n(a),l=n(99389),s=n(18509),u=n.n(s),d=n(94012),c=n.n(d);function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(e){function t(n){var r;return(r=e.call(this,t.URL)||this).user=n,r}(0,o.Z)(t,e);var n=t.prototype;return n.getMyQuests=function(){return this.fetch("/creators/"+this.user+"/quests",this.options().method("GET").authorization({sign:!0}))},n.publishQuest=function(e){(0,l.NJ)(e);for(var t,n=m(e.definition.steps);!(t=n()).done;)for(var r,o=m(t.value.tasks);!(r=o()).done;)for(var a,i=m(r.value.actionItems);!(a=i()).done;){var s=a.value;for(var u in s.parameters)"string"!=typeof s.parameters[u]&&(s.parameters[u]=JSON.stringify(s.parameters[u]))}return this.fetch("/quests",this.options().method("POST").authorization({sign:!0}).json(e).metadata(e))},n.getQuest=function(){var e=(0,r.Z)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch("/quests/"+t,this.options().method("GET").authorization({sign:!0}));case 2:return n=e.sent,r=null,e.prev=4,e.next=7,this.fetch("/quests/"+t+"/reward?with_hook=true",this.options().method("GET").authorization({sign:!0}));case 7:r=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.log(e.t0);case 13:return e.abrupt("return",Object.assign({},n.quest,{reward:r||void 0}));case 14:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}(),n.updateQuest=function(e,t){if(!t.name)throw new Error("Quest must have a name");return this.fetch("/quests/"+e,this.options().method("PUT").authorization({sign:!0}).json(t))},n.deactivateQuest=function(e){return this.fetch("/quests/"+e,this.options().method("DELETE").authorization({sign:!0}))},n.activateQuest=function(e){return this.fetch("/quests/"+e+"/activate",this.options().method("PUT").authorization({sign:!0}))},n.getOldVersions=function(e){return this.fetch("/quests/"+e+"/updates",this.options().method("GET"))},t}(u());v.URL=c()("QUESTS_SERVER_URL","https://quests.decentraland.org/api")},84791:function(e,t,n){n.r(t)}}]);
//# sourceMappingURL=component---src-pages-quests-old-[id]-tsx-032e50d6f4cc65b8c736.js.map