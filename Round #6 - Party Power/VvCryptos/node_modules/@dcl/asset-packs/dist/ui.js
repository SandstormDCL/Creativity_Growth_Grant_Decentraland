import { AlignMode, Font } from './enums';
function getAlignMode(align, isColumn) {
    switch (align) {
        case AlignMode.TAM_TOP_LEFT: {
            return {
                alignItems: 1,
                justifyContent: 0,
            };
        }
        case AlignMode.TAM_TOP_CENTER: {
            return isColumn
                ? {
                    alignItems: 2,
                    justifyContent: 0,
                }
                : {
                    alignItems: 1,
                    justifyContent: 1,
                };
        }
        case AlignMode.TAM_TOP_RIGHT: {
            return isColumn
                ? {
                    alignItems: 3,
                    justifyContent: 0,
                }
                : {
                    alignItems: 1,
                    justifyContent: 2,
                };
        }
        case AlignMode.TAM_MIDDLE_LEFT: {
            return isColumn
                ? {
                    alignItems: 1,
                    justifyContent: 1,
                }
                : {
                    alignItems: 2,
                    justifyContent: 0,
                };
        }
        case AlignMode.TAM_MIDDLE_CENTER: {
            return {
                alignItems: 2,
                justifyContent: 1,
            };
        }
        case AlignMode.TAM_MIDDLE_RIGHT: {
            return isColumn
                ? {
                    alignItems: 3,
                    justifyContent: 1,
                }
                : {
                    alignItems: 2,
                    justifyContent: 2,
                };
        }
        case AlignMode.TAM_BOTTOM_LEFT: {
            return isColumn
                ? {
                    alignItems: 1,
                    justifyContent: 2,
                }
                : {
                    alignItems: 2,
                    justifyContent: 1,
                };
        }
        case AlignMode.TAM_BOTTOM_CENTER: {
            return isColumn
                ? {
                    alignItems: 2,
                    justifyContent: 2,
                }
                : {
                    alignItems: 3,
                    justifyContent: 1,
                };
        }
        case AlignMode.TAM_BOTTOM_RIGHT: {
            return {
                alignItems: 3,
                justifyContent: 2,
            };
        }
    }
}
export function mapAlignToScreenAlign(align, flexDirection = 0) {
    const isColumn = flexDirection === 1;
    switch (align) {
        case AlignMode.TAM_TOP_LEFT:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_TOP_CENTER:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_TOP_RIGHT:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_MIDDLE_LEFT:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_MIDDLE_CENTER:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_MIDDLE_RIGHT:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_BOTTOM_LEFT:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_BOTTOM_CENTER:
            return getAlignMode(align, isColumn);
        case AlignMode.TAM_BOTTOM_RIGHT:
            return getAlignMode(align, isColumn);
        default:
            throw new Error(`Unsupported AlignMode: ${align}`);
    }
}
export function getUITransform(component, entiy, height = 100, width = 100, unit = 2) {
    let uiTransformComponent = component.getMutableOrNull(entiy);
    if (!uiTransformComponent) {
        uiTransformComponent = component.create(entiy);
        uiTransformComponent.heightUnit = unit;
        uiTransformComponent.widthUnit = unit;
        uiTransformComponent.height = height;
        uiTransformComponent.width = width;
        uiTransformComponent.maxHeightUnit = unit;
        uiTransformComponent.maxWidthUnit = unit;
        uiTransformComponent.maxHeight = height;
        uiTransformComponent.maxWidth = width;
    }
    if (entiy === 0) {
        uiTransformComponent.positionType = 1;
    }
    return uiTransformComponent;
}
export function getUIBackground(component, entity, src, textureMode = 0, wrapMode = 1) {
    return component.createOrReplace(entity, {
        textureMode,
        texture: {
            tex: {
                $case: 'texture',
                texture: {
                    src,
                    wrapMode,
                },
            },
        },
        uvs: [],
    });
}
function breakLines(text, linelength) {
    const lineBreak = '\n';
    let counter = 0;
    let line = '';
    let returnText = '';
    let bMatchFound = false;
    const lineLen = linelength ? linelength : 50;
    if (!text)
        return '';
    if (text.length < lineLen + 1) {
        return text;
    }
    while (counter < text.length) {
        line = text.substring(counter, counter + lineLen);
        bMatchFound = false;
        if (line.length == lineLen) {
            for (let i = line.length; i > -1; i--) {
                if (line.substring(i, i + 1) == ' ') {
                    counter += line.substring(0, i).length;
                    line = line.substring(0, i) + lineBreak;
                    returnText += line;
                    bMatchFound = true;
                    break;
                }
            }
            if (!bMatchFound) {
                counter += line.length;
                line = line + lineBreak;
                returnText += line;
            }
        }
        else {
            returnText += line;
            break;
        }
    }
    return returnText;
}
export function getUIText(component, entity, text, fontSize = 10, containerWidth, align = AlignMode.TAM_MIDDLE_CENTER, color = { r: 0, g: 0, b: 0, a: 1 }) {
    const lineLength = Math.floor(containerWidth / (fontSize / 1.7));
    return component.createOrReplace(entity, {
        value: breakLines(text, lineLength),
        fontSize,
        font: Font.F_MONOSPACE,
        textAlign: align,
        color,
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdWkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBWUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQW1CLE1BQU0sU0FBUyxDQUFBO0FBRzFELFNBQVMsWUFBWSxDQUFDLEtBQWdCLEVBQUUsUUFBaUI7SUFDdkQsUUFBUSxLQUFLLEVBQUUsQ0FBQztRQUNkLEtBQUssU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDNUIsT0FBTztnQkFDTCxVQUFVLEdBQXdCO2dCQUNsQyxjQUFjLEdBQTBCO2FBQ3pDLENBQUE7UUFDSCxDQUFDO1FBQ0QsS0FBSyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUM5QixPQUFPLFFBQVE7Z0JBQ2IsQ0FBQyxDQUFDO29CQUNFLFVBQVUsR0FBb0I7b0JBQzlCLGNBQWMsR0FBMEI7aUJBQ3pDO2dCQUNILENBQUMsQ0FBQztvQkFDRSxVQUFVLEdBQXdCO29CQUNsQyxjQUFjLEdBQXNCO2lCQUNyQyxDQUFBO1FBQ1AsQ0FBQztRQUNELEtBQUssU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFDN0IsT0FBTyxRQUFRO2dCQUNiLENBQUMsQ0FBQztvQkFDRSxVQUFVLEdBQXNCO29CQUNoQyxjQUFjLEdBQTBCO2lCQUN6QztnQkFDSCxDQUFDLENBQUM7b0JBQ0UsVUFBVSxHQUF3QjtvQkFDbEMsY0FBYyxHQUF3QjtpQkFDdkMsQ0FBQTtRQUNQLENBQUM7UUFDRCxLQUFLLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1lBQy9CLE9BQU8sUUFBUTtnQkFDYixDQUFDLENBQUM7b0JBQ0UsVUFBVSxHQUF3QjtvQkFDbEMsY0FBYyxHQUFzQjtpQkFDckM7Z0JBQ0gsQ0FBQyxDQUFDO29CQUNFLFVBQVUsR0FBb0I7b0JBQzlCLGNBQWMsR0FBMEI7aUJBQ3pDLENBQUE7UUFDUCxDQUFDO1FBQ0QsS0FBSyxTQUFTLENBQUMsaUJB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QixPQUFPLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQTtnQkFDdEIsSUFBSSxHQUFHLElBQUksR0FBRyxTQUFTLENBQUE7Z0JBQ3ZCLFVBQVUsSUFBSSxJQUFJLENBQUE7WUFDcEIsQ0FBQztRQUNILENBQUM7YUFBTSxDQUFDO1lBQ04sVUFBVSxJQUFJLElBQUksQ0FBQTtZQUNsQixNQUFLO1FBQ1AsQ0FBQztJQUNILENBQUM7SUFFRCxPQUFPLFVBQVUsQ0FBQTtBQUNuQixDQUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FDdkIsU0FBcUMsRUFDckMsTUFBYyxFQUNkLElBQVksRUFDWixRQUFRLEdBQUcsRUFBRSxFQUNiLGNBQXNCLEVBQ3RCLFFBQW1CLFNBQVMsQ0FBQyxpQkFBaUIsRUFDOUMsUUFBZ0IsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO0lBRTFDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxHQUFHLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFFaEUsT0FBTyxTQUFTLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRTtRQUN2QyxLQUFLLEVBQUUsVUFBVSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUM7UUFDbkMsUUFBUTtRQUNSLElBQUksRUFBRSxJQUFJLENBQUMsV0FBa0I7UUFDN0IsU0FBUyxFQUFFLEtBQWlDO1FBQzVDLEtBQUs7S0FDTixDQUFDLENBQUE7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQmFja2dyb3VuZFRleHR1cmVNb2RlLFxuICBFbnRpdHksXG4gIFRleHRBbGlnbk1vZGUsXG4gIFRleHR1cmVXcmFwTW9kZSxcbiAgWUdBbGlnbixcbiAgWUdGbGV4RGlyZWN0aW9uLFxuICBZR0p1c3RpZnksXG4gIFlHUG9zaXRpb25UeXBlLFxuICBZR1VuaXQsXG59IGZyb20gJ0BkY2wvZWNzJ1xuaW1wb3J0IHsgRW5naW5lQ29tcG9uZW50cyB9IGZyb20gJy4vZGVmaW5pdGlvbnMnXG5pbXBvcnQgeyBBbGlnbk1vZGUsIEZvbnQsIFNjcmVlbkFsaWduTW9kZSB9IGZyb20gJy4vZW51bXMnXG5pbXBvcnQgeyBDb2xvcjQgfSBmcm9tICdAZGNsL2Vjcy9kaXN0L2NvbXBvbmVudHMvZ2VuZXJhdGVkL3BiL2RlY2VudHJhbGFuZC9jb21tb24vY29sb3JzLmdlbidcblxuZnVuY3Rpb24gZ2V0QWxpZ25Nb2RlKGFsaWduOiBBbGlnbk1vZGUsIGlzQ29sdW1uOiBib29sZWFuKSB7XG4gIHN3aXRjaCAoYWxpZ24pIHtcbiAgICBjYXNlIEFsaWduTW9kZS5UQU1fVE9QX0xFRlQ6IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsaWduSXRlbXM6IFlHQWxpZ24uWUdBX0ZMRVhfU1RBUlQsXG4gICAgICAgIGp1c3RpZnlDb250ZW50OiBZR0p1c3RpZnkuWUdKX0ZMRVhfU1RBUlQsXG4gICAgICB9XG4gICAgfVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9UT1BfQ0VOVEVSOiB7XG4gICAgICByZXR1cm4gaXNDb2x1bW5cbiAgICAgICAgPyB7XG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiBZR0FsaWduLllHQV9DRU5URVIsXG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogWUdKdXN0aWZ5LllHSl9GTEVYX1NUQVJULFxuICAgICAgICAgIH1cbiAgICAgICAgOiB7XG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiBZR0FsaWduLllHQV9GTEVYX1NUQVJULFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFlHSnVzdGlmeS5ZR0pfQ0VOVEVSLFxuICAgICAgICAgIH1cbiAgICB9XG4gICAgY2FzZSBBbGlnbk1vZGUuVEFNX1RPUF9SSUdIVDoge1xuICAgICAgcmV0dXJuIGlzQ29sdW1uXG4gICAgICAgID8ge1xuICAgICAgICAgICAgYWxpZ25JdGVtczogWUdBbGlnbi5ZR0FfRkxFWF9FTkQsXG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogWUdKdXN0aWZ5LllHSl9GTEVYX1NUQVJULFxuICAgICAgICAgIH1cbiAgICAgICAgOiB7XG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiBZR0FsaWduLllHQV9GTEVYX1NUQVJULFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFlHSnVzdGlmeS5ZR0pfRkxFWF9FTkQsXG4gICAgICAgICAgfVxuICAgIH1cbiAgICBjYXNlIEFsaWduTW9kZS5UQU1fTUlERExFX0xFRlQ6IHtcbiAgICAgIHJldHVybiBpc0NvbHVtblxuICAgICAgICA/IHtcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFlHQWxpZ24uWUdBX0ZMRVhfU1RBUlQsXG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogWUdKdXN0aWZ5LllHSl9DRU5URVIsXG4gICAgICAgICAgfVxuICAgICAgICA6IHtcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFlHQWxpZ24uWUdBX0NFTlRFUixcbiAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiBZR0p1c3RpZnkuWUdKX0ZMRVhfU1RBUlQsXG4gICAgICAgICAgfVxuICAgIH1cbiAgICBjYXNlIEFsaWduTW9kZS5UQU1fTUlERExFX0NFTlRFUjoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxpZ25JdGVtczogWUdBbGlnbi5ZR0FfQ0VOVEVSLFxuICAgICAgICBqdXN0aWZ5Q29udGVudDogWUdKdXN0aWZ5LllHSl9DRU5URVIsXG4gICAgICB9XG4gICAgfVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9NSURETEVfUklHSFQ6IHtcbiAgICAgIHJldHVybiBpc0NvbHVtblxuICAgICAgICA/IHtcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFlHQWxpZ24uWUdBX0ZMRVhfRU5ELFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFlHSnVzdGlmeS5ZR0pfQ0VOVEVSLFxuICAgICAgICAgIH1cbiAgICAgICAgOiB7XG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiBZR0FsaWduLllHQV9DRU5URVIsXG4gICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogWUdKdXN0aWZ5LllHSl9GTEVYX0VORCxcbiAgICAgICAgICB9XG4gICAgfVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9CT1RUT01fTEVGVDoge1xuICAgICAgcmV0dXJuIGlzQ29sdW1uXG4gICAgICAgID8ge1xuICAgICAgICAgICAgYWxpZ25JdGVtczogWUdBbGlnbi5ZR0FfRkxFWF9TVEFSVCxcbiAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiBZR0p1c3RpZnkuWUdKX0ZMRVhfRU5ELFxuICAgICAgICAgIH1cbiAgICAgICAgOiB7XG4gICAgICAgICAgICBhbGlnbkl0ZW1zOiBZR0p1c3RpZnkuWUdKX0ZMRVhfRU5ELFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFlHQWxpZ24uWUdBX0ZMRVhfU1RBUlQsXG4gICAgICAgICAgfVxuICAgIH1cbiAgICBjYXNlIEFsaWduTW9kZS5UQU1fQk9UVE9NX0NFTlRFUjoge1xuICAgICAgcmV0dXJuIGlzQ29sdW1uXG4gICAgICAgID8ge1xuICAgICAgICAgICAgYWxpZ25JdGVtczogWUdBbGlnbi5ZR0FfQ0VOVEVSLFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFlHSnVzdGlmeS5ZR0pfRkxFWF9FTkQsXG4gICAgICAgICAgfVxuICAgICAgICA6IHtcbiAgICAgICAgICAgIGFsaWduSXRlbXM6IFlHQWxpZ24uWUdBX0ZMRVhfRU5ELFxuICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFlHSnVzdGlmeS5ZR0pfQ0VOVEVSLFxuICAgICAgICAgIH1cbiAgICB9XG4gICAgY2FzZSBBbGlnbk1vZGUuVEFNX0JPVFRPTV9SSUdIVDoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxpZ25JdGVtczogWUdBbGlnbi5ZR0FfRkxFWF9FTkQsXG4gICAgICAgIGp1c3RpZnlDb250ZW50OiBZR0p1c3RpZnkuWUdKX0ZMRVhfRU5ELFxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFwQWxpZ25Ub1NjcmVlbkFsaWduKFxuICBhbGlnbjogQWxpZ25Nb2RlLFxuICBmbGV4RGlyZWN0aW9uID0gWUdGbGV4RGlyZWN0aW9uLllHRkRfUk9XLFxuKTogU2NyZWVuQWxpZ25Nb2RlIHtcbiAgY29uc3QgaXNDb2x1bW4gPSBmbGV4RGlyZWN0aW9uID09PSBZR0ZsZXhEaXJlY3Rpb24uWUdGRF9DT0xVTU5cblxuICBzd2l0Y2ggKGFsaWduKSB7XG4gICAgY2FzZSBBbGlnbk1vZGUuVEFNX1RPUF9MRUZUOlxuICAgICAgcmV0dXJuIGdldEFsaWduTW9kZShhbGlnbiwgaXNDb2x1bW4pIGFzIGFueVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9UT1BfQ0VOVEVSOlxuICAgICAgcmV0dXJuIGdldEFsaWduTW9kZShhbGlnbiwgaXNDb2x1bW4pIGFzIGFueVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9UT1BfUklHSFQ6XG4gICAgICByZXR1cm4gZ2V0QWxpZ25Nb2RlKGFsaWduLCBpc0NvbHVtbikgYXMgYW55XG4gICAgY2FzZSBBbGlnbk1vZGUuVEFNX01JRERMRV9MRUZUOlxuICAgICAgcmV0dXJuIGdldEFsaWduTW9kZShhbGlnbiwgaXNDb2x1bW4pIGFzIGFueVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9NSURETEVfQ0VOVEVSOlxuICAgICAgcmV0dXJuIGdldEFsaWduTW9kZShhbGlnbiwgaXNDb2x1bW4pIGFzIGFueVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9NSURETEVfUklHSFQ6XG4gICAgICByZXR1cm4gZ2V0QWxpZ25Nb2RlKGFsaWduLCBpc0NvbHVtbikgYXMgYW55XG4gICAgY2FzZSBBbGlnbk1vZGUuVEFNX0JPVFRPTV9MRUZUOlxuICAgICAgcmV0dXJuIGdldEFsaWduTW9kZShhbGlnbiwgaXNDb2x1bW4pIGFzIGFueVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9CT1RUT01fQ0VOVEVSOlxuICAgICAgcmV0dXJuIGdldEFsaWduTW9kZShhbGlnbiwgaXNDb2x1bW4pIGFzIGFueVxuICAgIGNhc2UgQWxpZ25Nb2RlLlRBTV9CT1RUT01fUklHSFQ6XG4gICAgICByZXR1cm4gZ2V0QWxpZ25Nb2RlKGFsaWduLCBpc0NvbHVtbikgYXMgYW55XG4gICAgZGVmYXVsdDpcbiAgICAgIC8vIEhhbmRsZSBkZWZhdWx0IGNhc2Ugb3IgdGhyb3cgYW4gZXJyb3IgaWYgbmVlZGVkXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIEFsaWduTW9kZTogJHthbGlnbn1gKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVSVRyYW5zZm9ybShcbiAgY29tcG9uZW50OiBFbmdpbmVDb21wb25lbnRzWydVaVRyYW5zZm9ybSddLFxuICBlbnRpeTogRW50aXR5LFxuICBoZWlnaHQgPSAxMDAsXG4gIHdpZHRoID0gMTAwLFxuICB1bml0OiBZR1VuaXQgPSBZR1VuaXQuWUdVX1BFUkNFTlQsXG4pIHtcbiAgbGV0IHVpVHJhbnNmb3JtQ29tcG9uZW50ID0gY29tcG9uZW50LmdldE11dGFibGVPck51bGwoZW50aXkpXG5cbiAgaWYgKCF1aVRyYW5zZm9ybUNvbXBvbmVudCkge1xuICAgIHVpVHJhbnNmb3JtQ29tcG9uZW50ID0gY29tcG9uZW50LmNyZWF0ZShlbnRpeSlcbiAgICB1aVRyYW5zZm9ybUNvbXBvbmVudC5oZWlnaHRVbml0ID0gdW5pdFxuICAgIHVpVHJhbnNmb3JtQ29tcG9uZW50LndpZHRoVW5pdCA9IHVuaXRcbiAgICB1aVRyYW5zZm9ybUNvbXBvbmVudC5oZWlnaHQgPSBoZWlnaHRcbiAgICB1aVRyYW5zZm9ybUNvbXBvbmVudC53aWR0aCA9IHdpZHRoXG4gICAgdWlUcmFuc2Zvcm1Db21wb25lbnQubWF4SGVpZ2h0VW5pdCA9IHVuaXRcbiAgICB1aVRyYW5zZm9ybUNvbXBvbmVudC5tYXhXaWR0aFVuaXQgPSB1bml0XG4gICAgdWlUcmFuc2Zvcm1Db21wb25lbnQubWF4SGVpZ2h0ID0gaGVpZ2h0XG4gICAgdWlUcmFuc2Zvcm1Db21wb25lbnQubWF4V2lkdGggPSB3aWR0aFxuICB9XG5cbiAgaWYgKGVudGl5ID09PSAwKSB7XG4gICAgdWlUcmFuc2Zvcm1Db21wb25lbnQucG9zaXRpb25UeXBlID0gWUdQb3NpdGlvblR5cGUuWUdQVF9BQlNPTFVURVxuICB9XG5cbiAgcmV0dXJuIHVpVHJhbnNmb3JtQ29tcG9uZW50XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVSUJhY2tncm91bmQoXG4gIGNvbXBvbmVudDogRW5naW5lQ29tcG9uZW50c1snVWlCYWNrZ3JvdW5kJ10sXG4gIGVudGl0eTogRW50aXR5LFxuICBzcmM6IHN0cmluZyxcbiAgdGV4dHVyZU1vZGUgPSBCYWNrZ3JvdW5kVGV4dHVyZU1vZGUuTklORV9TTElDRVMsXG4gIHdyYXBNb2RlID0gVGV4dHVyZVdyYXBNb2RlLlRXTV9DTEFNUCxcbikge1xuICByZXR1cm4gY29tcG9uZW50LmNyZWF0ZU9yUmVwbGFjZShlbnRpdHksIHtcbiAgICB0ZXh0dXJlTW9kZSxcbiAgICB0ZXh0dXJlOiB7XG4gICAgICB0ZXg6IHtcbiAgICAgICAgJGNhc2U6ICd0ZXh0dXJlJyxcbiAgICAgICAgdGV4dHVyZToge1xuICAgICAgICAgIHNyYyxcbiAgICAgICAgICB3cmFwTW9kZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB1dnM6IFtdLFxuICB9KVxufVxuXG5mdW5jdGlvbiBicmVha0xpbmVzKHRleHQ6IHN0cmluZywgbGluZWxlbmd0aDogbnVtYmVyKSB7XG4gIGNvbnN0IGxpbmVCcmVhayA9ICdcXG4nXG4gIGxldCBjb3VudGVyID0gMFxuICBsZXQgbGluZSA9ICcnXG4gIGxldCByZXR1cm5UZXh0ID0gJydcbiAgbGV0IGJNYXRjaEZvdW5kID0gZmFsc2VcbiAgY29uc3QgbGluZUxlbiA9IGxpbmVsZW5ndGggPyBsaW5lbGVuZ3RoIDogNTBcblxuICBpZiAoIXRleHQpIHJldHVybiAnJ1xuICBpZiAodGV4dC5sZW5ndGggPCBsaW5lTGVuICsgMSkge1xuICAgIHJldHVybiB0ZXh0XG4gIH1cblxuICB3aGlsZSAoY291bnRlciA8IHRleHQubGVuZ3RoKSB7XG4gICAgbGluZSA9IHRleHQuc3Vic3RyaW5nKGNvdW50ZXIsIGNvdW50ZXIgKyBsaW5lTGVuKVxuICAgIGJNYXRjaEZvdW5kID0gZmFsc2VcbiAgICBpZiAobGluZS5sZW5ndGggPT0gbGluZUxlbikge1xuICAgICAgZm9yIChsZXQgaSA9IGxpbmUubGVuZ3RoOyBpID4gLTE7IGktLSkge1xuICAgICAgICBpZiAobGluZS5zdWJzdHJpbmcoaSwgaSArIDEpID09ICcgJykge1xuICAgICAgICAgIGNvdW50ZXIgKz0gbGluZS5zdWJzdHJpbmcoMCwgaSkubGVuZ3RoXG4gICAgICAgICAgbGluZSA9IGxpbmUuc3Vic3RyaW5nKDAsIGkpICsgbGluZUJyZWFrXG4gICAgICAgICAgcmV0dXJuVGV4dCArPSBsaW5lXG4gICAgICAgICAgYk1hdGNoRm91bmQgPSB0cnVlXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIWJNYXRjaEZvdW5kKSB7XG4gICAgICAgIGNvdW50ZXIgKz0gbGluZS5sZW5ndGhcbiAgICAgICAgbGluZSA9IGxpbmUgKyBsaW5lQnJlYWtcbiAgICAgICAgcmV0dXJuVGV4dCArPSBsaW5lXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVyblRleHQgKz0gbGluZVxuICAgICAgYnJlYWsgLy8gV2UncmUgYnJlYWtpbmcgb3V0IG9mIHRoZSB0aGUgd2hpbGUoKSwgbm90IHRoZSBmb3IoKVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXR1cm5UZXh0XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVSVRleHQoXG4gIGNvbXBvbmVudDogRW5naW5lQ29tcG9uZW50c1snVWlUZXh0J10sXG4gIGVudGl0eTogRW50aXR5LFxuICB0ZXh0OiBzdHJpbmcsXG4gIGZvbnRTaXplID0gMTAsXG4gIGNvbnRhaW5lcldpZHRoOiBudW1iZXIsXG4gIGFsaWduOiBBbGlnbk1vZGUgPSBBbGlnbk1vZGUuVEFNX01JRERMRV9DRU5URVIsXG4gIGNvbG9yOiBDb2xvcjQgPSB7IHI6IDAsIGc6IDAsIGI6IDAsIGE6IDEgfSxcbikge1xuICBjb25zdCBsaW5lTGVuZ3RoID0gTWF0aC5mbG9vcihjb250YWluZXJXaWR0aCAvIChmb250U2l6ZSAvIDEuNykpXG5cbiAgcmV0dXJuIGNvbXBvbmVudC5jcmVhdGVPclJlcGxhY2UoZW50aXR5LCB7XG4gICAgdmFsdWU6IGJyZWFrTGluZXModGV4dCwgbGluZUxlbmd0aCksXG4gICAgZm9udFNpemUsXG4gICAgZm9udDogRm9udC5GX01PTk9TUEFDRSBhcyBhbnksXG4gICAgdGV4dEFsaWduOiBhbGlnbiBhcyB1bmtub3duIGFzIFRleHRBbGlnbk1vZGUsXG4gICAgY29sb3IsXG4gIH0pXG59XG4iXX0=